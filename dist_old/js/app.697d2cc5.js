(function(e){function t(t){for(var a,o,n=t[0],l=t[1],u=t[2],d=0,h=[];d<n.length;d++)o=n[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);c&&c(t);while(h.length)h.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,n=1;n<s.length;n++){var l=s[n];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=s[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=a,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(s,a,function(t){return e[t]}.bind(null,a));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var u=0;u<n.length;u++)t(n[u]);var c=l;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"0698":function(e,t,s){},"21bb":function(e,t,s){},4627:function(e,t,s){"use strict";s("cb85")},"4cd8":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var a=s("2b0e"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.isToken?s("div",["list"===e.$store.getters.component?s("el-menu",{attrs:{"default-active":e.page,mode:"horizontal"},on:{select:e.setActiveMenu}},[e._l(e.menu,(function(t,a){return s("el-menu-item",{key:a,attrs:{index:a}},[e._v(e._s(t))])})),e.page in e.addLang?s("el-menu-item",{staticClass:"menu-right-element",on:{click:function(t){return e.$store.commit("setComponent","add")}}},[s("el-button",{staticClass:"menu-right-element-button"},[e._v(" Добавить "+e._s(e.addLang[e.page])+" ")])],1):e._e()],2):e._e(),s(e.page+"Page",{tag:"component"})],1):s("el-container",{staticClass:"body-wrapper"},[s("el-aside",{style:e.error?"background-color: #F56C6C":"background-color: #909399",attrs:{width:"20px"}}),s("el-main",[s("label",[e._v(e._s(e.error?e.error:"Ожидание авторизации на сервере!"))])])],1),"text"in e.$store.getters.message?s("div",{staticClass:"message_container"},[s("el-alert",{attrs:{type:e.$store.getters.message.type,"show-icon":"",title:e.$store.getters.message.header,description:e.$store.getters.message.description},on:{close:function(t){return e.$store.commit("setMessage",{})}},scopedSlots:e._u([{key:"default",fn:function(){return[s("span",{domProps:{innerHTML:e._s(e.$store.getters.message.text)}})]},proxy:!0}],null,!1,1538474048)})],1):e._e()],1)},i=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s(e.component,{tag:"component"})],1)},n=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание новой заявки")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип заявки")]),s("el-select",{attrs:{placeholder:"Тип заявки"},model:{value:e.queryData.type,callback:function(t){e.$set(e.queryData,"type",t)},expression:"queryData.type"}},e._l(e.queryType,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип доверенности")]),s("el-select",{class:e.errors.documentType?"invalid":"",attrs:{placeholder:"Тип доверенности"},model:{value:e.queryData.documentType,callback:function(t){e.$set(e.queryData,"documentType",t)},expression:"queryData.documentType"}},e._l(e.queryTypeDocument,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.documentType?s("small",[e._v(e._s(e.errors.documentType))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Организация, выдающая доверенность")]),s("el-select",{ref:"company_search",class:e.errors.company?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите организацию","remote-method":e.searchGiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type},on:{change:function(t){return e.clearSelectSearch("company_search")}},model:{value:e.queryData.company,callback:function(t){e.$set(e.queryData,"company",t)},expression:"queryData.company"}},e._l(e.company,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.company?s("small",[e._v(e._s(e.errors.company))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Кто получает доверенность")]),s("el-radio-group",{attrs:{fill:"#909399"},on:{change:e.whoReceiveChange},model:{value:e.whoReceive,callback:function(t){e.whoReceive=t},expression:"whoReceive"}},[s("el-radio-button",{attrs:{label:"Пользователь"}}),s("el-radio-button",{attrs:{label:"Организация",disabled:"personal"==e.queryData.type}})],1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v(e._s("Пользователь"===e.whoReceive?"Получает пользователь":"Получает организация"))]),s("el-select",{ref:"user_search",class:e.errors.users?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Пользователь"===e.whoReceive?"Укажите ФИО":"Укажите организацию","remote-method":"Пользователь"===e.whoReceive?e.searchReceiveUser:e.searchReceiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type,multiple:e.isMultipleUser},on:{change:function(t){return e.clearSelectSearch("user_search")}},model:{value:e.queryData.users,callback:function(t){e.$set(e.queryData,"users",t)},expression:"queryData.users"}},e._l(e.users,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.users?s("small",[e._v(e._s(e.errors.users))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Период действия документа")]),s("el-date-picker",{class:e.errors.dateStart||e.errors.date?"invalid":"",attrs:{"picker-options":{firstDayOfWeek:1},type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Начало действия документа"},model:{value:e.queryData.dateStart,callback:function(t){e.$set(e.queryData,"dateStart",t)},expression:"queryData.dateStart"}}),e.errors.date?s("small",[e._v(e._s(e.errors.date))]):e._e(),e.errors.dateStart?s("small",[e._v(e._s(e.errors.dateStart))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-date-picker",{class:e.errors.dateFinal||e.errors.date?"invalid":"",attrs:{"picker-options":{firstDayOfWeek:1},type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Окончание действия документа"},model:{value:e.queryData.dateFinal,callback:function(t){e.$set(e.queryData,"dateFinal",t)},expression:"queryData.dateFinal"}}),e.errors.dateFinal?s("small",[e._v(e._s(e.errors.dateFinal))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Функционал")]),s("el-select",{ref:"selectFunction",class:e.errors.functions?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(t){return s("el-option",{key:t.value,style:{width:e.$refs.selectFunction.$el.offsetWidth+30+"px",whiteSpace:"normal",height:"auto"},attrs:{label:t.label,value:t.value}},[s("div",{on:{mouseover:function(s){return e.mouseOnFunctionOptions(s,!0,t)},mouseout:function(t){return e.mouseOnFunctionOptions(t,!1,"")}}},[e._v(" "+e._s(t.label)+" ")])])})),1),e.errors.functions?s("small",[e._v(e._s(e.errors.functions))]):e._e()],1),s("el-col",{ref:"commentCol",attrs:{span:8}},[s("label",[e._v("Комментарий")]),s("el-input",{attrs:{type:"textarea",rows:"1"},model:{value:e.queryData.comment,callback:function(t){e.$set(e.queryData,"comment",t)},expression:"queryData.comment"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{ref:"uploadCol",attrs:{span:8}},[s("label",[e._v("Дополнительные файлы (прошлые доверенности НЕ прикладывать)")]),s("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1}},[s("el-button",{staticClass:"fluid-button",attrs:{size:"medium",icon:"el-icon-download",type:"info"},on:{click:function(t){e.errors.functions=null}}},[e._v(" Добавить файл")])],1)],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")])]),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.saveForm}},[e._v(" Отправить заявку ")])],1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:24}},[s("br"),s("el-link",{attrs:{href:"https://bitrix.bsi.local/knowledge/instrukcii/korportal/doverrennosti/",target:"_blank",type:"danger",icon:"el-icon-reading"}},[e._v("Ознакомиться с инструкцией")])],1)],1),e.functionsDetail.show?s("div",{staticClass:"context-menu-wrapper"},[e.functionsDetail.note?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Примечание")]),e._v(" "+e._s(e.functionsDetail.note))]):e._e(),e.functionsDetail.text?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Описание ")]),e._v(" "+e._s(e.functionsDetail.text))]):e._e()]):e._e()],1)},u=[],c={name:"requestAdd",data:function(){return{functionsDetail:{show:!1,text:"",note:""},isMultipleUser:!1,whoReceive:"Пользователь",users:[],usersSelected:[],company:[],companySelected:[],functions:[],errors:{},queryData:{type:"personal",users:null,company:"",documentType:"special",dateStart:"",dateFinal:"",functions:[],comment:"",file:[],isFile:!1}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},queryTypeDocument(){return this.$store.getters.queryTypeDocument},queryType(){return this.$store.getters.queryType}},methods:{mouseOnFunctionOptions(e,t,s){t?(this.functionsDetail.show=!0,this.functionsDetail.text=s.text,this.functionsDetail.note=s.note,this.$nextTick(()=>{let t=document.querySelector(".context-menu-wrapper"),s={y:e.clientY};t.style.maxWidth="45%",t.style.position="relative",t.style.left=this.$refs.selectFunction.$el.offsetWidth+62+"px",s.y<this.$refs.selectFunction.$el.getBoundingClientRect().y?t.style.top=-426-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px":t.style.top=-102-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px"})):(this.functionsDetail.show=!1,this.functionsDetail.text="",this.functionsDetail.note="")},clearSelectSearch:function(e){this.$refs[e].query=""},searchReceiveUser:function(e){""!==e&&this.search(e,"receiveUser")},searchReceiveCompany:function(e){""!==e&&this.search(e,"receiveCompany")},searchGiveCompany:function(e){""!==e&&this.search(e,"giveCompany")},search:async function(e,t){let s,a;"receiveUser"==t&&(a="users",s="/api/vicarious/user/search"),"receiveCompany"==t&&(a="users",s="/api/vicarious/company/search"),"giveCompany"==t&&(a="company",s="/api/vicarious/company/search");let r=await this.$store.dispatch("query",{url:s,data:{q:e}});"success"==r.status&&(this[a]=r.data,this[a+"Selected"].forEach(e=>{let t=!0;this[a].forEach(s=>s.value==e.value?t=!1:""),t&&this[a].push(e)}))},getData:async function(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/user/get-for-request",data:{}});"success"==e.status&&(this.queryData.users=e.data.user.value,this.users.push(e.data.user),this.queryData.company=e.data.company.value,this.company.push(e.data.company));let t=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==t.status&&(this.functions=t.data.map(e=>({value:e.id[0].value,label:e.name[0].value,text:e.text[0].value,note:e.note[0].value}))),this.queryData.dateStart=(new Date).toLocaleDateString(),this.loading=!1},saveForm:async function(){if(this.$refs.upload.uploadFiles.length>0?this.queryData.isFile=!0:this.queryData.isFile=!1,this.errors=await this.$store.dispatch("formIsValid",{queryData:this.queryData}),0===Object.keys(this.errors).length){this.loading=!0;let e,t=new FormData;t.append("type",this.queryData.type),t.append("documentType",this.queryData.documentType),t.append("dateStart",this.queryData.dateStart),t.append("dateFinal",this.queryData.dateFinal),t.append("comment",this.queryData.comment),t.append("company",this.queryData.company),"Пользователь"===this.whoReceive?t.append("receiver","individual"):t.append("receiver","entity");for(let s=0;s<this.$refs.upload.uploadFiles.length;s++)t.append("file["+s+"]",this.$refs.upload.uploadFiles[s].raw);if(this.queryData.users instanceof Array)for(let s=0;s<this.queryData.users.length;s++)t.append("users["+s+"]",this.queryData.users[s]);else t.append("users[0]",this.queryData.users);for(let s=0;s<this.queryData.functions.length;s++)t.append("functions["+s+"]",this.queryData.functions[s]);e=await this.$store.dispatch("query",{url:"/api/vicarious/request/add",data:t,type:"file"}),"success"==e.status?(this.$store.commit("setMessage",{text:e.message,type:"success"}),this.$store.commit("setComponent","list")):this.$store.commit("setMessage",{text:e.message,type:"error"}),this.loading=!1}},whoReceiveChange(){this.queryData.users=null,this.users=[],this.usersSelected=[],this.errors.functions=null}},created(){this.getData()},watch:{"queryData.type":function(e){"complex"===e&&"notarial"!==this.queryData.documentType&&(this.queryData.users="",this.isMultipleUser=!1,this.usersSelected=[],this.queryData.company=""),"complex"===e&&"notarial"===this.queryData.documentType&&(this.queryData.users="",setTimeout(()=>{this.queryData.users=[],this.isMultipleUser=!0},0),this.queryData.company=""),"personal"===e&&(this.users=[],this.usersSelected=[],this.company=[],this.queryData.users="",this.isMultipleUser=!1,this.whoReceive="Пользователь",this.getData())},"queryData.users":function(e){if(this.errors.users=null,e instanceof Array){this.users.forEach(t=>{if(e.indexOf(t.value)>=0){let e=!0;this.usersSelected.forEach(s=>s.value===t.value?e=!1:""),e&&this.usersSelected.push(t)}});let t=[];this.usersSelected.forEach(s=>e.indexOf(s.value)>=0?t.push(s):""),this.usersSelected=t}},"queryData.company":function(e){this.errors.company=null,e&&this.companySelected.push(e)},"queryData.functions":function(){this.errors.functions=null},"queryData.comment":function(){this.errors.functions=null},"queryData.documentType":function(e,t){if("notarial"===e&&"personal"!==this.queryData.type){let e=this.queryData.users;this.queryData.users="",setTimeout(()=>{this.queryData.users=e?[e]:[],this.isMultipleUser=!0},0),e&&(this.usersSelected=[e])}if("notarial"===t&&"personal"!==this.queryData.type){let e="";this.queryData.users[0]&&(e=this.queryData.users[0]),this.queryData.users=[],setTimeout(()=>{this.isMultipleUser=!1,this.queryData.users=e},0),this.isMultipleUser=!1,this.queryData.users=e,this.usersSelected=[e]}this.errors.documentType=null},"queryData.dateStart":function(){this.errors.date=null,this.errors.dateStart=null},"queryData.dateFinal":function(){this.errors.date=null,this.errors.dateFinal=null}}},d=c,h=s("2877"),m=Object(h["a"])(d,l,u,!1,null,null,null),p=m.exports,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.toBack.apply(null,arguments)}}},[e._v(" Вернуться к просмотру ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание новой заявки")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип заявки")]),s("el-select",{attrs:{placeholder:"Тип заявки"},on:{change:function(t){return e.queryTypeChange(e.queryData.type)}},model:{value:e.queryData.type,callback:function(t){e.$set(e.queryData,"type",t)},expression:"queryData.type"}},e._l(e.queryType,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип доверенности")]),s("el-select",{attrs:{placeholder:"Тип доверенности"},on:{change:function(t){return e.queryTypeDocumentChange(e.queryData.documentType)}},model:{value:e.queryData.documentType,callback:function(t){e.$set(e.queryData,"documentType",t)},expression:"queryData.documentType"}},e._l(e.queryTypeDocument,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Организация, выдающая доверенность")]),s("el-select",{ref:"company_search",class:e.errors.company?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите организацию","remote-method":e.searchGiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type},on:{change:function(t){return e.clearSelectSearch("company_search")}},model:{value:e.queryData.company,callback:function(t){e.$set(e.queryData,"company",t)},expression:"queryData.company"}},e._l(e.company,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.company?s("small",[e._v(e._s(e.errors.company))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Кто получает доверенность")]),s("el-radio-group",{attrs:{fill:"#909399"},on:{change:e.whoReceiveChange},model:{value:e.whoReceive,callback:function(t){e.whoReceive=t},expression:"whoReceive"}},[s("el-radio-button",{attrs:{label:"Пользователь"}}),s("el-radio-button",{attrs:{label:"Организация",disabled:"personal"==e.queryData.type}})],1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v(e._s("Пользователь"===e.whoReceive?"Получает пользователь":"Получает организация"))]),s("el-select",{ref:"user_search",class:e.errors.users?"invalid":"",attrs:{multiple:e.isMultipleUser,filterable:"",remote:"","reserve-keyword":"",placeholder:"Пользователь"===e.whoReceive?"Укажите ФИО":"Укажите организацию","remote-method":"Пользователь"===e.whoReceive?e.searchReceiveUser:e.searchReceiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type},on:{change:function(t){return e.clearSelectSearch("user_search")}},model:{value:e.queryData.users,callback:function(t){e.$set(e.queryData,"users",t)},expression:"queryData.users"}},e._l(e.users,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.users?s("small",[e._v(e._s(e.errors.users))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Период действия документа")]),s("el-date-picker",{class:e.errors.dateStart||e.errors.date?"invalid":"",attrs:{type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Начало действия документа","picker-options":{firstDayOfWeek:1}},model:{value:e.queryData.dateStart,callback:function(t){e.$set(e.queryData,"dateStart",t)},expression:"queryData.dateStart"}}),e.errors.date?s("small",[e._v(e._s(e.errors.date))]):e._e(),e.errors.dateStart?s("small",[e._v(e._s(e.errors.dateStart))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-date-picker",{class:e.errors.dateFinal||e.errors.date?"invalid":"",attrs:{type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Окончание действия документа","picker-options":{firstDayOfWeek:1}},model:{value:e.queryData.dateFinal,callback:function(t){e.$set(e.queryData,"dateFinal",t)},expression:"queryData.dateFinal"}}),e.errors.dateFinal?s("small",[e._v(e._s(e.errors.dateFinal))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Функционал")]),s("el-select",{ref:"selectFunction",class:e.errors.functions?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(t){return s("el-option",{key:t.value,style:{width:e.$refs.selectFunction.$el.offsetWidth+30+"px",whiteSpace:"normal",height:"auto"},attrs:{label:t.label,value:t.value}},[s("div",{on:{mouseover:function(s){return e.mouseOnFunctionOptions(s,!0,t)},mouseout:function(t){return e.mouseOnFunctionOptions(t,!1,"")}}},[e._v(" "+e._s(t.label)+" ")])])})),1),e.errors.functions?s("small",[e._v(e._s(e.errors.functions))]):e._e()],1),s("el-col",{ref:"commentCol",attrs:{span:8}},[s("label",[e._v("Комментарий")]),s("el-input",{attrs:{type:"textarea",rows:"1"},model:{value:e.queryData.comment,callback:function(t){e.$set(e.queryData,"comment",t)},expression:"queryData.comment"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{ref:"uploadCol",attrs:{span:8}},[s("label",[e._v("Дополнительные файлы (прошлые доверенности НЕ прикладывать)")]),s("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1,"file-list":e.queryData.file_exists,"on-change":e.fileChange,"on-remove":e.fileRemove}},[s("el-button",{staticClass:"fluid-button",attrs:{size:"medium",icon:"el-icon-download",type:"info"},on:{click:function(t){e.errors.functions=null}}},[e._v(" Добавить файл ")])],1)],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")])]),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.saveForm}},[e._v(" Отправить заявку ")])],1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:24}},[s("br"),s("el-link",{attrs:{href:"https://bitrix.bsi.local/knowledge/instrukcii/korportal/doverrennosti/",target:"_blank",type:"danger",icon:"el-icon-reading"}},[e._v("Ознакомиться с инструкцией")])],1)],1),e.functionsDetail.show?s("div",{staticClass:"context-menu-wrapper"},[e.functionsDetail.note?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Примечание")]),e._v(" "+e._s(e.functionsDetail.note))]):e._e(),e.functionsDetail.text?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Описание ")]),e._v(" "+e._s(e.functionsDetail.text))]):e._e()]):e._e()],1)},g=[],f={name:"requestEdit",data(){return{functionsDetail:{show:!1,text:"",note:""},oldDocumentTypeValue:"",isMultipleUser:!1,whoReceive:"",users:[],usersSelected:[],company:[],companySelected:[],functions:[],errors:{},queryData:{type:"",users:null,company:"",documentType:"",dateStart:"",dateFinal:"",functions:[],comment:"",file:[],file_save:[],file_exists:[],isFile:!1}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},queryTypeDocument(){return this.$store.getters.queryTypeDocument},queryType(){return this.$store.getters.queryType},requestId(){return this.$store.getters.requestId}},methods:{mouseOnFunctionOptions(e,t,s){t?(this.functionsDetail.show=!0,this.functionsDetail.text=s.text,this.functionsDetail.note=s.note,this.$nextTick(()=>{let t=document.querySelector(".context-menu-wrapper"),s={y:e.clientY};t.style.maxWidth="45%",t.style.position="relative",t.style.left=this.$refs.selectFunction.$el.offsetWidth+60+"px",s.y<this.$refs.selectFunction.$el.getBoundingClientRect().y?t.style.top=-426-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px":t.style.top=-102-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px"})):(this.functionsDetail.show=!1,this.functionsDetail.text="",this.functionsDetail.note="")},toBack(){this.$store.commit("setPage",this.$store.getters.previousPage),this.$store.commit("setComponent","detail")},clearSelectSearch(e){this.$refs[e].query="",this.$forceUpdate()},searchReceiveUser(e){""!==e&&this.search(e,"receiveUser")},searchReceiveCompany(e){""!==e&&this.search(e,"receiveCompany")},searchGiveCompany(e){""!==e&&this.search(e,"giveCompany")},async search(e,t){let s,a;"receiveUser"==t&&(a="users",s="/api/vicarious/user/search"),"receiveCompany"==t&&(a="users",s="/api/vicarious/company/search"),"giveCompany"==t&&(a="company",s="/api/vicarious/company/search");let r=await this.$store.dispatch("query",{url:s,data:{q:e}});"success"==r.status&&(this[a]=r.data,this[a+"Selected"].forEach(e=>{let t=!0;this[a].forEach(s=>s.value==e.value?t=!1:""),t&&this[a].push(e)}))},async getSaveData(){this.loading=!0,this.company=[];let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value,text:e.text[0].value,note:e.note[0].value})));let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/get-edit",data:{id:this.requestId}});if("success"==t.status){"individual"===t.data.receiver?this.whoReceive="Пользователь":this.whoReceive="Организация",this.users=t.data.users,this.company.push(t.data.company);let e=null;"notarial"===t.data.documentType&&"personal"!==t.data.type?(this.isMultipleUser=!0,e=t.data.users.map(e=>e.value)):(this.isMultipleUser=!1,e=t.data.users.length>0?t.data.users[0].value:"");let s=new Date(t.data.date_start.split(".").reverse().join(".")),a=s.getTime(),r=new Date(t.data.date_final.split(".").reverse().join(".")),i=r.getTime(),o=i-a,n=i+864e5,l=n+o,u=new Date(n).toLocaleDateString(),c=new Date(l).toLocaleDateString();this.queryData={type:t.data.type,company:t.data.company.value,documentType:"only"==t.data.document_type?"special":t.data.document_type,users:e,dateStart:u,dateFinal:c,functions:t.data.functions,comment:t.data.comment,file_save:t.data.files,file_exists:t.data.files,file:[]},"personal"===t.data.type&&this.getPersonalData()}else this.$store.commit("setMessage",{text:t.message,header:"Возникла проблема!",type:"error"});this.loading=!1},async getPersonalData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/user/get-for-request",data:{}});"success"==e.status&&(e.data.user.value&&(this.queryData.users=e.data.user.value,this.users=[],this.users.push(e.data.user)),this.queryData.company=e.data.company.value,this.company=[],this.company.push(e.data.company)),this.loading=!1},fileChange(e,t){this.queryData.file.push(e.raw)},fileRemove(e){this.queryData.file_save=this.queryData.file_save.filter(t=>t.uid!==e.uid),this.queryData.file=this.queryData.file.filter(t=>t.uid!==e.uid)},async saveForm(){if(this.$refs.upload.uploadFiles.length>0?this.queryData.isFile=!0:this.queryData.isFile=!1,this.errors=await this.$store.dispatch("formIsValid",{queryData:this.queryData}),0===Object.keys(this.errors).length){let e;if(this.loading=!0,this.queryData.file.length){let t=new FormData;t.append("type",this.queryData.type),t.append("documentType",this.queryData.documentType),t.append("dateStart",this.queryData.dateStart),t.append("dateFinal",this.queryData.dateFinal),t.append("comment",this.queryData.comment),t.append("company",this.queryData.company),"Пользователь"===this.whoReceive?t.append("receiver","individual"):t.append("receiver","entity");for(let e=0;e<this.queryData.file.length;e++)t.append("file["+e+"]",this.queryData.file[e]);for(let e=0;e<this.queryData.file_save.length;e++)t.append("file_save["+e+"]",this.queryData.file_save[e].id);if(this.queryData.users instanceof Array)for(let e=0;e<this.queryData.users.length;e++)t.append("users["+e+"]",this.queryData.users[e]);else t.append("users[0]",this.queryData.users);for(let e=0;e<this.queryData.functions.length;e++)t.append("functions["+e+"]",this.queryData.functions[e]);e=await this.$store.dispatch("query",{url:"/api/vicarious/request/add",data:t,type:"file"})}else this.queryData.file_save=this.queryData.file_save.map(e=>e.id),"Пользователь"===this.whoReceive?this.queryData.receiver="individual":this.queryData.receiver="entity",e=await this.$store.dispatch("query",{url:"/api/vicarious/request/add",data:this.queryData});"success"==e.status?this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1,this.$store.commit("setPage","request"),this.$store.commit("setComponent","list")}},queryTypeChange(e){"complex"===e&&"notarial"!==this.queryData.documentType&&(this.queryData.users="",this.isMultipleUser=!1,this.usersSelected=[],this.queryData.company=""),"complex"===e&&"notarial"===this.queryData.documentType&&(this.queryData.users="",setTimeout(()=>{this.queryData.users=[],this.isMultipleUser=!0},0),this.queryData.company=""),"personal"===e&&(this.whoReceive="Пользователь",this.users=[],this.usersSelected=[],this.company=[],this.queryData.users="",this.isMultipleUser=!1,this.getPersonalData())},queryTypeDocumentChange(e){let t=this.oldDocumentTypeValue;if("notarial"===e&&"personal"!==this.queryData.type){let e=this.queryData.users;this.queryData.users="",setTimeout(()=>{this.queryData.users=e?[e]:[],this.isMultipleUser=!0},0),e&&(this.usersSelected=[e])}if("notarial"===t&&"personal"!==this.queryData.type){let e;this.queryData.users[0]&&(e=this.queryData.users[0]),this.queryData.users=[],setTimeout(()=>{this.isMultipleUser=!1,this.queryData.users=e},0),this.usersSelected=[e]}},whoReceiveChange(){this.queryData.users=null,this.users=[],this.usersSelected=[],this.errors.functions=null}},created(){this.getSaveData()},watch:{"queryData.documentType":function(e){this.oldDocumentTypeValue=e,this.errors.documentType=null},"queryData.users":function(e){if(this.errors.users=null,e instanceof Array){this.users.forEach(t=>{if(e.indexOf(t.value)>=0){let e=!0;this.usersSelected.forEach(s=>s.value===t.value?e=!1:""),e&&this.usersSelected.push(t)}});let t=[];this.usersSelected.forEach(s=>e.indexOf(s.value)>=0?t.push(s):""),this.usersSelected=t}},"queryData.company":function(e){this.errors.company=null,e&&this.companySelected.push(e)},"queryData.functions":function(){this.errors.functions=null},"queryData.comment":function(){this.errors.functions=null},"queryData.dateStart":function(){this.errors.date=null,this.errors.dateStart=null},"queryData.dateFinal":function(){this.errors.date=null,this.errors.dateFinal=null}}},v=f,b=Object(h["a"])(v,y,g,!1,null,null,null),q=b.exports,_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.gridReady?s("Grid",{directives:[{name:"event-bus",rawName:"v-event-bus:saveVisibleColumn",value:e.saveVisibleColumn,expression:"saveVisibleColumn",arg:"saveVisibleColumn"},{name:"event-bus",rawName:"v-event-bus:saveOrderColumn",value:e.saveOrderColumn,expression:"saveOrderColumn",arg:"saveOrderColumn"},{name:"event-bus",rawName:"v-event-bus:saveWidthColumn",value:e.saveWidthColumn,expression:"saveWidthColumn",arg:"saveWidthColumn"},{name:"event-bus",rawName:"v-event-bus:onSort",value:e.onSort,expression:"onSort",arg:"onSort"},{name:"event-bus",rawName:"v-event-bus:changeFilterProfile",value:e.changeFilterProfile,expression:"changeFilterProfile",arg:"changeFilterProfile"}],attrs:{name:"request"}}):e._e()],1)},w=[],D={name:"requestList",data:function(){return{grid:{filter:{data:{id:{show:!1,type:"number",name:"ID"},usersIndividual:{type:"searchlist",name:"Доверенное лицо",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},usersEntity:{show:!1,type:"searchlist",name:"Доверенная организация",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/company/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},type:{show:!1,type:"list",name:"Тип заявки",multiple:!0,option:this.$store.getters.queryType},document_type:{show:!1,type:"list",name:"Тип доверенности",multiple:!0,option:this.$store.getters.queryTypeDocument},needApprove:{type:"list",name:"Согласование",multiple:!1,option:[{value:[1],label:"Требует моего согласования"},{value:[0],label:"Не требует моего согласования"}]},needAction:{type:"list",name:"Управление заявкой",multiple:!1,option:[{value:[1],label:"Требует моего участия"},{value:[0],label:"Не требует моего участия"}]},creator:{show:!1,type:"searchlist",name:"Заказчик",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},created_at:{show:!1,type:"date",name:"Дата создания заявки"},responsible:{show:!1,type:"searchlist",name:"Ответственный",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},responsible_date:{show:!1,type:"date",name:"Дата обработки заявки"},status:{type:"list",name:"Статус",multiple:!0,option:this.$store.getters.statusList},signature:{type:"list",name:"Заявка на подписании",multiple:!0,option:[{value:"0",label:"Заявки НЕ на подписании"},{value:"1",label:"Заявки на подписании"}]},company_id:{type:"searchlist",name:"Организация",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/company/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},date_start:{show:!1,type:"date",name:"Дата начала действия документа"},date_final:{show:!1,type:"date",name:"Дата окончания действия документа"},functions:{show:!1,type:"searchlist",name:"Функционал документа",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/function/search",data:{q:e}});if("success"==t.status){let e=t.data.map(e=>({value:e.value,label:e.label}));return e}}.bind(this),focus:async function(){let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{sort:{name:"sort",order:"asc"}}});if("success"==e.status){let t=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value}));return t}}.bind(this)}},profiles:[],showProfiles:!0,filter:function(e){this.filterData=e,this.$store.commit("setPaginationPage",1),this.getData()}.bind(this),clear:function(){this.filterData={},this.getData()}.bind(this)},context:[{name:"Открыть заявку",function:e=>{this.$store.commit("setRequestId",e.id[0].value),this.$store.commit("setComponent","detail")}},{name:"Копировать заявку",function:e=>{this.$store.commit("setRequestId",e.id[0].value),this.$confirm(`Вы уверены, что хотите создать новую заявку на основе данных заявки с ID - ${e.id[0].value} ?`).then(()=>{this.$store.commit("setPage","request"),this.$store.commit("setComponent","addByExist")}).catch(()=>{this.$store.commit("setRequestId",null)})}}],pagination:{show:"full",defaultSize:10,page:1,sizes:[10,20,50],changeSize:e=>{this.$store.commit("setPaginationSize",e),this.$grid.commit("normalizePagination",{name:this.grid.name,data:{pagination:{defaultSize:e}}}),this.getData()},changePage:e=>{this.$store.commit("setPaginationPage",e),this.getData()}},header:{id:{name:"ID",child:["users"],width:100,contentSort:!0},users:{name:"Пользователи документа",width:300},company:{name:"Организация",width:300},functions:{name:"Функционал документа",width:300},status:{name:"Статус",width:150,contentSort:!0},date_start:{name:"Дата начала действия документа",width:300,contentSort:!0},date_final:{name:"Дата окончания действия документа",width:300,contentSort:!0},created_at:{name:"Дата создания заявки",width:200,contentSort:!0},responsible_date:{name:"Дата обработки заявки",width:200,contentSort:!0},type:{name:"Тип заявки",width:200,contentSort:!0},document_type:{name:"Тип доверенности",width:200,contentSort:!0},creator:{name:"Заказчик",width:300},responsible:{name:"Ответственный",width:300},comment:{name:"Комментарии",width:700},files:{name:"Дополнительные файлы",width:300}},elements:[],name:"request"},filterData:{},sort:{name:"id",order:"desc"},gridReady:!1}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0;let e=await this.$store.dispatch("normalizeFilterData",this.filterData),t="";t=this.$store.getters.charters("showAll")?"showAll":"";let s=await this.$store.dispatch("query",{url:"/api/vicarious/request/list",data:{count:this.$store.getters.paginationSize,page:this.$store.getters.paginationPage,filter:e,charters:t,sort:this.sort}});"success"==s.status?(this.$grid.commit("normalizeElement",{name:this.grid.name,data:{elements:s.data}}),this.$grid.commit("normalizePagination",{name:this.grid.name,data:{pagination:{page:this.$store.getters.paginationPage,...s.pagination}}})):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},onSort(e){this.sort.name=e.key,this.sort.name===e.key?"asc"===this.sort.order?this.sort.order="desc":this.sort.order="asc":this.sort.order="desc",this.getData()},saveVisibleColumn(e){let t=e=>{this.grid.header[e.key].show=e.show,this.grid.header[e.key].child instanceof Array&&this.grid.header[e.key].child.forEach((s,a)=>{let r={key:this.grid.header[e.key].child[a],show:e.show};t(r)})};t(e),this.setHeaderParams()},saveWidthColumn(e){this.grid.header[e.key].width=e.width,this.setHeaderParams()},saveOrderColumn(e){e.data.forEach(e=>{let t=e.key,s=e.params.sort;this.grid.header[t].sort=s}),this.setHeaderParams()},async setHeaderParams(){let e=Object.keys(this.grid.header),t=e.map((e,t)=>{let s;return s=!("show"in this.grid.header[e])||this.grid.header[e].show,{key:e,width:this.grid.header[e].width,show:s,sort:this.grid.header[e].sort}}),s=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,params:JSON.stringify(t),type:"set"}});"success"==s.status?this.$store.commit("setMessage",{text:s.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})},async changeFilterProfile(e){this.loading=!0,"add"===e.action&&this.grid.filter.profiles.push({name:e.name,data:e.data}),"remove"===e.action&&this.grid.filter.profiles.splice(e.idx,1);let t=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:e.grid,params:JSON.stringify(this.grid.filter.profiles),type:"set"}});"success"==t.status?this.$store.commit("setMessage",{text:t.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},async initGrid(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,type:"get"}});if("success"==e.status&&e.data.length>0){let t=JSON.parse(e.data[0]);t.forEach(e=>{e.key in this.grid.header&&(this.grid.header[e.key].show=e.show,this.grid.header[e.key].width=e.width,this.grid.header[e.key].sort=e.sort)})}if("success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),e=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:this.grid.name,type:"get"}}),"success"===e.status&&e.data.length>0){let t=JSON.parse(e.data);t.forEach(e=>{this.grid.filter.profiles.push(e)})}"success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.$grid.dispatch("createGrid",{name:this.grid.name,data:this.grid}),await this.getData(),this.gridReady=!0,this.loading=!1}},created(){window.vicariousLoadFile=async(e,t,s)=>{try{let a=await this.$store.dispatch("query",{url:"/api/vicarious/request/load-file",downloadRequest:!0,data:{id:e,type:s}}),r=await a.blob(),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=t,o.click(),URL.revokeObjectURL(o.href)}catch(a){this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}return!1},this.initGrid()}},$=D,x=Object(h["a"])($,_,w,!1,null,null,null),S=x.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","detail")}}},[e._v(" Вернуться к просмотру ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Редактирование заявки с ID - "+e._s(e.requestId)+" ")]),e.documentId?s("h3",[e._v("Обратите внимание - по данной заявке уже создан документ c ID - "+e._s(e.documentId)+" и именем - "+e._s(e.documentName)+" !")]):e._e(),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип заявки")]),s("el-select",{attrs:{placeholder:"Тип заявки"},on:{change:function(t){return e.queryTypeChange(e.queryData.type)}},model:{value:e.queryData.type,callback:function(t){e.$set(e.queryData,"type",t)},expression:"queryData.type"}},e._l(e.queryType,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип доверенности")]),s("el-select",{attrs:{placeholder:"Тип доверенности"},on:{change:function(t){return e.queryTypeDocumentChange(e.queryData.documentType)}},model:{value:e.queryData.documentType,callback:function(t){e.$set(e.queryData,"documentType",t)},expression:"queryData.documentType"}},e._l(e.queryTypeDocument,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.isRoot&&e.documentId?s("el-col",{attrs:{span:8}},[s("label",[e._v("Имя документа")]),s("el-input",{staticStyle:{"white-space":"normal !important"},model:{value:e.queryData.document_name,callback:function(t){e.$set(e.queryData,"document_name",t)},expression:"queryData.document_name"}})],1):e._e()],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Организация, выдающая доверенность")]),s("el-select",{ref:"company_search",class:e.errors.company?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите организацию","remote-method":e.searchGiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type},on:{change:function(t){return e.clearSelectSearch("company_search")}},model:{value:e.queryData.company,callback:function(t){e.$set(e.queryData,"company",t)},expression:"queryData.company"}},e._l(e.company,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.company?s("small",[e._v(e._s(e.errors.company))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Кто получает доверенность")]),s("el-radio-group",{attrs:{fill:"#909399"},on:{change:e.whoReceiveChange},model:{value:e.whoReceive,callback:function(t){e.whoReceive=t},expression:"whoReceive"}},[s("el-radio-button",{attrs:{label:"Пользователь"}}),s("el-radio-button",{attrs:{label:"Организация",disabled:"personal"==e.queryData.type}})],1)],1),s("el-col",{attrs:{span:8}},[s("label",[e._v(e._s("Пользователь"===e.whoReceive?"Получает пользователь":"Получает организация"))]),s("el-select",{ref:"user_search",class:e.errors.users?"invalid":"",attrs:{multiple:e.isMultipleUser,filterable:"",remote:"","reserve-keyword":"",placeholder:"Пользователь"===e.whoReceive?"Укажите ФИО":"Укажите организацию","remote-method":"Пользователь"===e.whoReceive?e.searchReceiveUser:e.searchReceiveCompany,loading:e.loading,disabled:"personal"==e.queryData.type},on:{change:function(t){return e.clearSelectSearch("user_search")}},model:{value:e.queryData.users,callback:function(t){e.$set(e.queryData,"users",t)},expression:"queryData.users"}},e._l(e.users,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.users?s("small",[e._v(e._s(e.errors.users))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Период действия документа")]),s("el-date-picker",{class:e.errors.dateStart||e.errors.date?"invalid":"",attrs:{type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Начало действия документа","picker-options":{firstDayOfWeek:1}},model:{value:e.queryData.dateStart,callback:function(t){e.$set(e.queryData,"dateStart",t)},expression:"queryData.dateStart"}}),e.errors.date?s("small",[e._v(e._s(e.errors.date))]):e._e(),e.errors.dateStart?s("small",[e._v(e._s(e.errors.dateStart))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-date-picker",{class:e.errors.dateFinal||e.errors.date?"invalid":"",attrs:{type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Окончание действия документа","picker-options":{firstDayOfWeek:1}},model:{value:e.queryData.dateFinal,callback:function(t){e.$set(e.queryData,"dateFinal",t)},expression:"queryData.dateFinal"}}),e.errors.dateFinal?s("small",[e._v(e._s(e.errors.dateFinal))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Функционал")]),s("el-select",{ref:"selectFunction",class:e.errors.functions?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(t){return s("el-option",{key:t.value,style:{width:e.$refs.selectFunction.$el.offsetWidth+30+"px",whiteSpace:"normal",height:"auto"},attrs:{label:t.label,value:t.value}},[s("div",{on:{mouseover:function(s){return e.mouseOnFunctionOptions(s,!0,t)},mouseout:function(t){return e.mouseOnFunctionOptions(t,!1,"")}}},[e._v(" "+e._s(t.label)+" ")])])})),1),e.errors.functions?s("small",[e._v(e._s(e.errors.functions))]):e._e()],1),s("el-col",{ref:"commentCol",attrs:{span:8}},[s("label",[e._v("Комментарий")]),s("el-input",{attrs:{type:"textarea",rows:"1"},model:{value:e.queryData.comment,callback:function(t){e.$set(e.queryData,"comment",t)},expression:"queryData.comment"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{ref:"uploadCol",attrs:{span:8}},[s("label",[e._v("Дополнительные файлы (прошлые доверенности НЕ прикладывать)")]),s("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1,"file-list":e.queryData.file_exists,"on-change":e.fileChange,"on-remove":e.fileRemove}},[s("el-button",{staticClass:"fluid-button",attrs:{size:"medium",icon:"el-icon-download",type:"info"},on:{click:function(t){e.errors.functions=null}}},[e._v(" Добавить файл ")])],1)],1),s("el-col",{attrs:{span:8}},[s("label",[s("br")])]),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.saveForm}},[e._v(" Сохранить изменения в заявке c ID "+e._s(e.requestId)+" ")])],1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:24}},[s("br"),s("el-link",{attrs:{href:"https://bitrix.bsi.local/knowledge/instrukcii/korportal/doverrennosti/",target:"_blank",type:"danger",icon:"el-icon-reading"}},[e._v("Ознакомиться с инструкцией")])],1)],1),e.functionsDetail.show?s("div",{staticClass:"context-menu-wrapper"},[e.functionsDetail.note?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Примечание")]),e._v(" "+e._s(e.functionsDetail.note))]):e._e(),e.functionsDetail.text?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Описание ")]),e._v(" "+e._s(e.functionsDetail.text))]):e._e()]):e._e()],1)},k=[],I={name:"requestEdit",data(){return{functionsDetail:{show:!1,text:"",note:""},oldDocumentTypeValue:"",isMultipleUser:!1,whoReceive:"",users:[],usersSelected:[],company:[],companySelected:[],functions:[],errors:{},queryData:{document_name:"",document_id:"",type:"",users:null,company:"",documentType:"",dateStart:"",dateFinal:"",functions:[],comment:"",file:[],file_save:[],file_exists:[],isFile:!1}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},queryTypeDocument(){return this.$store.getters.queryTypeDocument},queryType(){return this.$store.getters.queryType},requestId(){return this.$store.getters.requestId},documentId(){return this.$store.getters.documentId},documentName(){return this.$store.getters.documentName},isRoot(){return this.$store.getters.charters("root")}},methods:{mouseOnFunctionOptions(e,t,s){t?(this.functionsDetail.show=!0,this.functionsDetail.text=s.text,this.functionsDetail.note=s.note,this.$nextTick(()=>{let t=document.querySelector(".context-menu-wrapper"),s={y:e.clientY};t.style.maxWidth="45%",t.style.position="relative",t.style.left=this.$refs.selectFunction.$el.offsetWidth+60+"px",s.y<this.$refs.selectFunction.$el.getBoundingClientRect().y?t.style.top=-426-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px":t.style.top=-102-this.$refs.commentCol.$el.clientHeight+68-this.$refs.uploadCol.$el.clientHeight+59+"px"})):(this.functionsDetail.show=!1,this.functionsDetail.text="",this.functionsDetail.note="")},clearSelectSearch(e){this.$refs[e].query="",this.$forceUpdate()},searchReceiveUser(e){""!==e&&this.search(e,"receiveUser")},searchReceiveCompany(e){""!==e&&this.search(e,"receiveCompany")},searchGiveCompany(e){""!==e&&this.search(e,"giveCompany")},async search(e,t){let s,a;"receiveUser"==t&&(a="users",s="/api/vicarious/user/search"),"receiveCompany"==t&&(a="users",s="/api/vicarious/company/search"),"giveCompany"==t&&(a="company",s="/api/vicarious/company/search");let r=await this.$store.dispatch("query",{url:s,data:{q:e}});"success"==r.status&&(this[a]=r.data,this[a+"Selected"].forEach(e=>{let t=!0;this[a].forEach(s=>s.value==e.value?t=!1:""),t&&this[a].push(e)}))},async getEditData(){this.loading=!0,this.company=[];let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value,text:e.text[0].value,note:e.note[0].value})));let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/get-edit",data:{id:this.requestId}});if("success"==t.status){"individual"===t.data.receiver?this.whoReceive="Пользователь":this.whoReceive="Организация",this.users=t.data.users,this.company.push(t.data.company);let e,s=null;"notarial"===t.documentType&&"personal"!==t.type?(this.isMultipleUser=!0,s=t.data.users.map(e=>e.value)):(this.isMultipleUser=!1,s=t.data.users.length>0?t.data.users[0].value:""),this.queryData={id:this.requestId,type:t.data.type,document_name:this.documentName,document_id:this.documentId,company:t.data.company.value,documentType:t.data.document_type,users:s,dateStart:t.data.date_start,dateFinal:t.data.date_final,functions:t.data.functions,comment:t.data.comment,file_save:t.data.files,file_exists:t.data.files,file:[]},this.$store.getters.statusList.forEach(s=>{s.value===t.data.status&&(e=s.label)}),this.$store.commit("setRequestState",{status:t.data.status,value:e})}else this.$store.commit("setMessage",{text:t.message,header:"Возникла проблема!",type:"error"});this.loading=!1},async getPersonalData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/user/get-for-request",data:{}});"success"==e.status&&(this.queryData.users=e.data.user.value,this.users.push(e.data.user),this.queryData.company=e.data.company.value,this.company.push(e.data.company)),this.loading=!1},fileChange(e){this.queryData.file.push(e.raw)},fileRemove(e){this.queryData.file_save=this.queryData.file_save.filter(t=>t.uid!==e.uid),this.queryData.file=this.queryData.file.filter(t=>t.uid!==e.uid)},async saveForm(){this.$refs.upload.uploadFiles.length>0?this.queryData.isFile=!0:this.queryData.isFile=!1,this.errors=await this.$store.dispatch("formIsValid",{queryData:this.queryData}),""===this.queryData.document_name&&(this.queryData.document_name=this.documentName),0===Object.keys(this.errors).length&&this.$confirm(`Вы точно уверены, что хотите сохранить изменения в заявке с ID - ${this.requestId} ?`).then(async()=>{let e;if(this.loading=!0,this.queryData.file.length){let t=new FormData;t.append("id",this.queryData.id),t.append("type",this.queryData.type),t.append("document_name",this.queryData.document_name),t.append("document_id",this.queryData.document_id),t.append("documentType",this.queryData.documentType),t.append("dateStart",this.queryData.dateStart),t.append("dateFinal",this.queryData.dateFinal),t.append("comment",this.queryData.comment),t.append("company",this.queryData.company),"Пользователь"===this.whoReceive?t.append("receiver","individual"):t.append("receiver","entity");for(let e=0;e<this.queryData.file.length;e++)t.append("file["+e+"]",this.queryData.file[e]);for(let e=0;e<this.queryData.file_save.length;e++)t.append("file_save["+e+"]",this.queryData.file_save[e].id);if(this.queryData.users instanceof Array)for(let e=0;e<this.queryData.users.length;e++)t.append("users["+e+"]",this.queryData.users[e]);else t.append("users[0]",this.queryData.users);for(let e=0;e<this.queryData.functions.length;e++)t.append("functions["+e+"]",this.queryData.functions[e]);e=await this.$store.dispatch("query",{url:"/api/vicarious/request/set-edit",data:t,type:"file"})}else this.queryData.file_save=this.queryData.file_save.map(e=>e.id),"Пользователь"===this.whoReceive?this.queryData.receiver="individual":this.queryData.receiver="entity",e=await this.$store.dispatch("query",{url:"/api/vicarious/request/set-edit",data:this.queryData});"success"==e.status?(await this.getEditData(),this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1,this.$store.commit("setComponent","detail")}).catch(()=>{})},queryTypeChange(e){"complex"===e&&"notarial"!==this.queryData.documentType&&(this.queryData.users="",this.isMultipleUser=!1,this.usersSelected=[],this.queryData.company=""),"complex"===e&&"notarial"===this.queryData.documentType&&(this.queryData.users="",setTimeout(()=>{this.queryData.users=[],this.isMultipleUser=!0},0),this.queryData.company=""),"personal"===e&&(this.whoReceive="Пользователь",this.users=[],this.usersSelected=[],this.company=[],this.queryData.users="",this.isMultipleUser=!1,this.getPersonalData())},queryTypeDocumentChange(e){let t=this.oldDocumentTypeValue;if("notarial"===e&&"personal"!==this.queryData.type){let e=this.queryData.users;this.queryData.users="",setTimeout(()=>{this.queryData.users=e?[e]:[],this.isMultipleUser=!0},0),e&&(this.usersSelected=[e])}if("notarial"===t&&"personal"!==this.queryData.type){let e;this.queryData.users[0]&&(e=this.queryData.users[0]),this.queryData.users=[],setTimeout(()=>{this.isMultipleUser=!1,this.queryData.users=e},0),this.usersSelected=[e]}},whoReceiveChange(){this.queryData.users=null,this.users=[],this.usersSelected=[],this.errors.functions=null}},created(){this.getEditData()},watch:{"queryData.documentType":function(e){this.oldDocumentTypeValue=e,this.errors.documentType=null},"queryData.users":function(e){if(this.errors.users=null,e instanceof Array){this.users.forEach(t=>{if(e.indexOf(t.value)>=0){let e=!0;this.usersSelected.forEach(s=>s.value===t.value?e=!1:""),e&&this.usersSelected.push(t)}});let t=[];this.usersSelected.forEach(s=>e.indexOf(s.value)>=0?t.push(s):""),this.usersSelected=t}},"queryData.company":function(e){this.errors.company=null,e&&this.companySelected.push(e)},"queryData.functions":function(){this.errors.functions=null},"queryData.comment":function(){this.errors.functions=null},"queryData.dateStart":function(){this.errors.date=null,this.errors.dateStart=null},"queryData.dateFinal":function(){this.errors.date=null,this.errors.dateFinal=null}}},R=I,F=Object(h["a"])(R,C,k,!1,null,null,null),M=F.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-tabs",{staticClass:"component-wrapper",attrs:{type:"border-card"},on:{"tab-click":e.setActiveMenu},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}},[e._l(e.menu,(function(e,t){return s("el-tab-pane",{key:t,attrs:{label:e,name:t}})})),"show"===e.page?s("Show"):e._e(),"business"===e.page?s("Business",{on:{toShowPage:function(t){e.page="show"}}}):e._e(),"comments"===e.page?s("Comments",{on:{toShowPage:function(t){e.page="show"}}}):e._e(),"history"===e.page?s("History",{on:{toShowPage:function(t){e.page="show"}}}):e._e()],2),s("div",{staticClass:"component-wrapper"},[s("br"),s("el-link",{attrs:{href:"https://bitrix.bsi.local/knowledge/instrukcii/korportal/doverrennosti/",target:"_blank",type:"danger",icon:"el-icon-reading"}},[e._v("Ознакомиться с инструкцией")])],1)],1)},j=[],P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:18}},[s("h2",[e._v(" Заявка № "+e._s(e.requestId))]),s("h3",[e._v("Статус заявки - "+e._s(e.requestStatus.value)+" "+e._s(e.signature?", на подписании":"")+" "+e._s("rejected"===e.requestStatus.status?"(доп. информация в истории согласования)":""))])]),s("el-col",{attrs:{span:6}},[e.isManageRequest&&e.gen_document?s("div",{staticClass:"component-wrapper"},[s("el-button",{staticStyle:{"white-space":"normal !important"},attrs:{size:"medium",icon:"el-icon-document ",type:"info"},on:{click:e.goToDocument}},[e._v(" Перейти к документу № "+e._s(e.documentName)+" ")])],1):e._e()])],1),e.loading?e._e():s("ShowInfo",{attrs:{show:e.show}}),"completed"!==e.requestStatus.status||e.reject?e._e():s("div",{staticClass:"body-button-container"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-plus",type:"info"},on:{click:e.addByExist}},[e._v(" Копировать заявку ")])],1),"completed"===e.requestStatus.status||"deleted"===e.requestStatus.status||e.reject?e._e():s("div",{staticClass:"body-button-container"},[e.isCreator||e.isResponsible||e.isRoot?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-edit",type:"info",disabled:e.notPossibleEdit},on:{click:e.editRequest}},[e._v(" Редактировать заявку ")]):e._e(),(e.isCreator||e.isDeleteRejected)&&"deleted"!==e.requestStatus.status?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-delete",type:"danger",disabled:e.notPossibleDelete},on:{click:e.deleteRequest}},[e._v(" Удалить заявку ")]):e._e(),e.isManageRequest&&"created"===e.requestStatus.status?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-check",type:"info",disabled:"created"!==e.requestStatus.status},on:{click:e.performRequest}},[e._v(" Принять заявку ")]):e._e(),(e.isResponsible||e.isRoot)&&"performed"===e.requestStatus.status?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-close",type:"info"},on:{click:e.rejectRequest}},[e._v(" Отклонить заявку ")]):e._e()],1),e.reject?s("div",{staticClass:"component-wrapper"},[e._m(0),s("el-input",{class:e.errors.comment?"invalid":"",attrs:{type:"textarea",rows:"4"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),e.errors.comment?s("small",[e._v(e._s(e.errors.comment))]):e._e(),s("div",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.cancelRejectRequest}},[e._v(" Назад ")]),s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-check",type:"info"},on:{click:e.confirmRejectRequest}},[e._v(" Отклонить ")])],1)],1):e._e(),"completed"===e.requestStatus.status||e.isCreator||e.isManageRequest||e.isDeleteRejected?e._e():s("div",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",icon:"el-icon-back",plain:"",type:"info"},on:{click:function(t){return e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")])],1)],1)},O=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("label",[s("b",[e._v("Причина отклонения заявки")])])}],E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-table",{staticClass:"tableWithOutHeader",attrs:{data:e.show.table_1}},[s("el-table-column",{attrs:{prop:"label_1",width:"350"}}),s("el-table-column",{attrs:{width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.value_1,(function(t){return s("p",{staticStyle:{margin:"0px"}},[s("span",{domProps:{innerHTML:e._s(t)}})])}))}}])}),s("el-table-column",{attrs:{prop:"label_2",width:"350"}}),s("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.value_2,(function(t){return s("p",{staticStyle:{margin:"0px"}},[s("span",{domProps:{innerHTML:e._s(t)}})])}))}}])})],1),s("el-table",{attrs:{data:e.show.table_2}},[s("el-table-column",{attrs:{prop:"label",width:"350"}}),s("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.value,(function(t){return s("p",{staticStyle:{margin:"0px"}},[s("span",{domProps:{innerHTML:e._s(t)}})])}))}}])})],1)],1)},N=[],z={name:"requestDetailShowInfo",props:["show"]},L=z,A=Object(h["a"])(L,E,N,!1,null,null,null),U=A.exports,W={name:"requestDetailShow",components:{ShowInfo:U},data(){return{comment:"",show:{table_1:[],table_2:[]},functions:[],reject:!1,map:{},errors:{comment:""}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},notPossibleEdit(){return this.isManageRequest?"created"!==this.requestStatus.status&&"rejected"!==this.requestStatus.status&&"performed"!==this.requestStatus.status:this.isCreator?"created"!==this.requestStatus.status&&"rejected"!==this.requestStatus.status:void 0},notPossibleDelete(){return!(("created"===this.requestStatus.status||"rejected"===this.requestStatus.status)&&this.isCreator||"rejected"===this.requestStatus.status&&this.isDeleteRejected)},requestId(){return this.$store.getters.requestId},requestStatus(){return this.$store.getters.requestState},gen_document(){return this.$store.getters.genDocument},signature(){return this.$store.getters.signature},documentId(){return this.$store.getters.documentId},documentName(){return this.$store.getters.documentName},user_id(){return this.$store.getters.userId},isCreator(){return this.$store.getters.isCreator},isResponsible(){return this.$store.getters.isResponsible},isManageRequest(){return this.$store.getters.charters("manageRequest")},isRoot(){return this.$store.getters.charters("root")},isDeleteRejected(){this.$store.getters.charters("deleteRejected")}},methods:{goToDocument(){this.$store.commit("setPage","document"),this.$store.commit("setComponent","detail")},addByExist(){this.$confirm(`Вы уверены, что хотите создать новую заявку на основе данных заявки с ID - ${this.requestId} ?`).then(()=>{this.$store.commit("setPage","request"),this.$store.commit("setComponent","addByExist")}).catch(()=>{})},editRequest(){this.$confirm(`Вы уверены, что хотите Редактировать заявку с ID - ${this.requestId} ?`).then(()=>{this.$store.commit("setComponent","edit")}).catch(()=>{})},deleteRequest(){"created"===this.requestStatus.status||"rejected"===this.requestStatus.status?this.$confirm(`Вы уверены, что хотите удалить заявку с ID - ${this.requestId} ?`).then(async()=>{this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/delete",data:{id:this.requestId}});"success"==e.status?(this.$store.commit("setComponentParams",{}),this.$store.commit("setRequestState",{}),this.$store.commit("setGenDocument",!1),this.$store.commit("setCreatorId",null),this.$store.commit("setResponsibleId",null),this.$store.commit("setComponent","list"),this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}).catch(()=>{}):this.$store.commit("setMessage",{header:`Текущий статус заявки - ${this.requestStatus.value}.`,text:'Удалить возможно только заявку со статусом - "Заявка создана" или "Заявка отклонена"  !',type:"warning"})},performRequest(){"created"===this.requestStatus.status?this.$confirm(`Вы уверены, что хотите Принять в работу заявку с ID - ${this.requestId} ?`).then(async()=>{this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/set-work",data:{id:this.requestId}});"success"==e.status?(this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}),this.$store.commit("setResponsibleId",this.user_id),await this.getData(),this.$store.commit("setRequestState",{status:e.request_status.en,value:e.request_status.rus})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}).catch(()=>{}):this.$store.commit("setMessage",{header:`Текущий статус заявки - ${this.requestStatus.value}.`,text:'Принять в работу возможно только заявку со статусом - "Заявка создана" !',type:"warning"})},rejectRequest(){this.reject=!0,setTimeout(()=>{window.scrollTo(0,15e3)},0)},confirmRejectRequest(){this.comment?this.$confirm(`Вы уверены, что хотите Отклонить заявку с ID - ${this.requestId} ?`).then(async()=>{this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/set-reject",data:{id:this.requestId,document_id:this.documentId,solution:!1,reason:this.comment}});"success"==e.status?(this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}),await this.getData(),this.$store.commit("setRequestState",{status:e.request_status.en,value:e.request_status.rus}),this.$store.commit("setSignature",0)):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема с отклонением заявки!",type:"error"}),this.comment="",this.reject=!1,this.loading=!1}).catch(()=>{}):this.errors.comment="Необходимо указать причину!"},cancelRejectRequest(){this.comment="",this.reject=!1},async getData(){this.loading=!0,this.$store.getters.queryType.forEach(e=>{this.map[e.value]=e.label}),this.$store.getters.queryTypeDocument.forEach(e=>{this.map[e.value]=e.label}),this.$store.getters.statusList.forEach(e=>{this.map[e.value]=e.label});let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value})));let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/get-edit",data:{id:this.requestId}});if("success"==t.status){t.data.document.length>0?(this.$store.commit("setDocumentId",t.data.document[0].id),this.$store.commit("setDocumentName",t.data.document[0].name),this.$store.commit("setDocumentStorage",t.data.document[0].storage)):(this.$store.commit("setDocumentId",null),this.$store.commit("setDocumentName",null),this.$store.commit("setDocumentStorage",null)),this.$store.commit("setRequestState",t.data.status[0]),this.$store.commit("setGenDocument",t.data.gen_document),this.$store.commit("document_project",t.data.document_project),t.data.document_project?this.$store.commit("projectFile",t.data.project_files[0].value):this.$store.commit("projectFile",{}),this.$store.commit("setSignature",t.data.signature),this.$store.commit("setCreatorId",t.data.creator[0].value),t.data.responsible.length>0&&this.$store.commit("setResponsibleId",t.data.responsible[0].key);let e=[];t.data.functions.length>0?t.data.functions.forEach(t=>{this.functions.forEach(s=>{s.value===t&&e.push(s.label)})}):e.push("Нет данных");let s="";s="rejected"===this.requestStatus.status?t.data.date_cancel+", "+t.data.who_cancel+",  причина - "+t.data.reason:"";let a=[];t.data.files.length>0?a=t.data.files.map(e=>e.value):a.push("Нет данных"),this.show.table_1=[{label_1:"Тип заявки",value_1:[this.map[t.data.type]],label_2:"Дата создания заявки",value_2:[t.data.created_at]},{label_1:"Тип доверенности",value_1:[this.map[t.data.document_type]],label_2:"Дата принятия заявки",value_2:[t.data.responsible_date]}];let r=[],i="";if(i=t.data.receiver,"individual"===i){if(t.data.users.length>0)for(let o=0;o<t.data.users.length;o++)if(r.push(t.data.users[o].href+", "+t.data.users[o].department+", "+t.data.users[o].position),t.data.users[o].org instanceof Array)for(let e=0;e<t.data.users[o].org.length;e++)r.push("( "+t.data.users[o].org[e].name+", "+t.data.users[o].org[e].position+" )")}else t.data.users.length>0&&r.push(t.data.users[0].label);this.show.table_2=[{label:"Заказчик",value:t.data.creator.map(e=>e.label+", "+e.department+", "+e.position)},{label:"individual"===i?"Доверенное лицо":"Доверенная организация",value:r},{label:"Ответственный",value:[t.data.responsible[0].value]},{label:"Организация",value:[t.data.company.label]},{label:"Функционал",value:e},{label:"Дата начала действия документа",value:[t.data.date_start]},{label:"Дата окончания действия документа",value:[t.data.date_final]},{label:"Причина отклонения / аннулирования",value:[s]},{label:"Комментарии",value:[t.data.comment]},{label:"Дополнительные файлы (прошлые доверенности НЕ прикладывать)",value:a}]}else this.$store.commit("setMessage",{text:t.message,header:"Возникла проблема!",type:"error"});this.loading=!1,setTimeout(()=>{window.scrollTo(0,15e3)},0)}},created(){window.vicariousLoadFile=async function(e,t,s){try{let a=await this.$store.dispatch("query",{url:"/api/vicarious/request/load-file",downloadRequest:!0,data:{id:e,type:s}}),r=await a.blob(),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=t,o.click(),URL.revokeObjectURL(o.href)}catch(a){this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}return!1}.bind(this),this.getData()},watch:{comment:function(){this.errors.comment=null}}},V=W,H=Object(h["a"])(V,P,O,!1,null,null,null),G=H.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"body-wrapper"},[s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:18}},[s("h2",[e._v(" Заявка № "+e._s(e.requestId))]),s("h3",[e._v("Статус заявки - "+e._s(e.requestStatus.value)+" "+e._s(e.signature?", на подписании":"")+" "+e._s("rejected"===e.requestStatus.status?"(доп. информация в истории согласования)":""))])]),s("el-col",{attrs:{span:6}},[!e.isResponsible&&!e.isRoot||"completed"!==e.requestStatus.status&&"agree"!==e.requestStatus.status&&"deleted"!==e.requestStatus.status?e._e():s("div",{staticClass:"component-wrapper"},[s("el-button",{attrs:{size:"medium",icon:"el-icon-refresh-left",type:"danger"},on:{click:e.returnToWork}},[e._v(" Вернуть заявку в работу ")])],1),!e.isResponsible&&!e.isRoot||"performed"!==e.requestStatus.status&&"rejected"!==e.requestStatus.status?e._e():s("div",{staticClass:"component-wrapper"},[s("el-button",{attrs:{size:"medium",icon:"el-icon-refresh-left",type:"danger"},on:{click:e.returnToCreated}},[e._v(' Вернуть на "Заявка создана" ')])],1)])],1),s("el-container",[s("el-aside",{class:["label-color-grey",{"label-color-green":"agree"===e.requestStatus.status||"completed"===e.requestStatus.status},{"label-color-red":"rejected"===e.requestStatus.status||"deleted"===e.requestStatus.status}],attrs:{width:"20px"}}),s("el-main",["deleted"===e.requestStatus.status?s("label",[e._v(" Заявка была удалена ")]):e._e(),"created"===e.requestStatus.status?s("label",[e._v(" Заявка ожидает обработки ")]):e._e(),"performed"!==e.requestStatus.status||e.isApproving?e._e():s("label",[e._v(" Заявка принята в работу "),e.signature?s("span",[e._v(", на подписании")]):e._e()]),"performed"===e.requestStatus.status&&e.isApproving?s("label",[e._v(" Создание листа согласования заявки ")]):e._e(),"pending_agree"===e.requestStatus.status?s("label",[e._v(' Заявка в процессе согласования. Подробнее во вкладке "История согласования" ')]):e._e(),"agree"===e.requestStatus.status?s("label",[e._v(' Заявка согласована. Подробнее во вкладке "История согласования" ')]):e._e(),"completed"===e.requestStatus.status?s("label",[e._v(" Заявка выполнена ")]):e._e(),"rejected"===e.requestStatus.status?s("label",[e._v(" Заявка отклонена ")]):e._e()])],1),e.documentId?s("p",[e._v("Документ - № "+e._s(e.documentName))]):e._e(),e.document_project?s("p",[e._v(" Проект документа - "),s("span",{domProps:{innerHTML:e._s(e.project_file)}})]):e._e(),e.documentStorage?s("p",[e._v("Место хранения оригинала документа - "+e._s(e.queryData.storageName))]):e._e(),s("hr"),!e.isResponsible&&!e.isRoot||e.isApproving?e._e():s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},["performed"===e.requestStatus.status||"agree"===e.requestStatus.status?s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-download",type:"info"},on:{click:e.getDocument}},[e._v(" Сформировать проект документа ")])],1):e._e(),"performed"===e.requestStatus.status&&e.gen_document?s("el-row",{staticClass:"component-wrapper"},[s("el-upload",{ref:"uploadProject",staticClass:"body-button ",attrs:{action:"","auto-upload":!1,"on-change":e.fileChange}},[s("el-button",{attrs:{size:"medium",icon:"el-icon-document",type:"info"}},[e._v(" Загрузить проект документа ")])],1)],1):e._e(),"performed"===e.requestStatus.status&&e.document_project?s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-coordinate",type:"info"},on:{click:function(t){e.isApproving=!0}}},[e._v(" Согласовать заявку ")])],1):e._e(),"performed"!==e.requestStatus.status&&"agree"!==e.requestStatus.status||!e.document_project?e._e():s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-edit-outline",type:"info"},on:{click:e.toSignature}},[e._v(" "+e._s(e.signature?"Отозвать с подписания":"Отдать на подписание")+" ")]),s("div",{staticClass:"body-button-container"},[s("span",{staticClass:"body-button"},[s("label",[e._v("Хранение оригинала")]),s("el-select",{class:e.errors.storage?"invalid":"",attrs:{placeholder:"Хранение оригинала"},model:{value:e.queryData.storageId,callback:function(t){e.$set(e.queryData,"storageId",t)},expression:"queryData.storageId"}},e._l(e.storages,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-button",{attrs:{size:"medium",icon:"el-icon-check",type:"primary"},on:{click:e.saveStorage}})],1)],1),"performed"!==e.requestStatus.status&&"agree"!==e.requestStatus.status||!e.documentStorage?e._e():s("el-row",{staticClass:"component-wrapper"},[s("el-upload",{ref:"uploadScan",staticClass:"body-button",attrs:{action:"","auto-upload":!1,"on-change":e.completedRequest,multiple:!1}},[s("el-button",{attrs:{size:"medium",icon:"el-icon-upload2",type:"info"}},[e._v(" Загрузить подписанный документ ")])],1)],1)],1),e.isApproving?s("div",["performed"===e.requestStatus.status?s("Add",{staticClass:"component-wrapper"}):e._e(),"pending_agree"===e.requestStatus.status?s("Pending",{staticClass:"component-wrapper"}):e._e(),"pending_agree"===e.requestStatus.status&&(e.isResponsible||e.isRoot)?s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.backToShow}},[e._v(" Вернуться к информации о заявке ")]),s("el-button",{staticClass:"body-button",attrs:{icon:"el-icon-close",type:"danger"},on:{click:e.cancelApprove}},[e._v(" Остановить согласование ")])],1):e._e(),s("div",{staticClass:"component-wrapper"},["performed"===e.requestStatus.status&&(e.isResponsible||e.isRoot)?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:function(t){e.isApproving=!1}}},[e._v(" Назад ")]):e._e()],1)],1):e._e(),(e.isResponsible||e.isRoot)&&"completed"===e.requestStatus.status?s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button",staticStyle:{"white-space":"normal !important"},attrs:{size:"medium",icon:"el-icon-document",type:"info"},on:{click:e.goToDocument}},[e._v(" Перейти к документу № "+e._s(e.documentName)+" ")])],1):e._e(),e.isApproving?e._e():s("el-row",{staticClass:"component-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.backToShow}},[e._v(" Вернуться к информации о заявке ")])],1)],1)},J=[],Y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[s("div",[s("h3",[e._v("Согласование заявки")]),e._m(0),s("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите согласующего","remote-method":e.searchApprover,loading:e.loading},on:{change:e.addApprover},model:{value:e.approver,callback:function(t){e.approver=t},expression:"approver"}},e._l(e.approverFromSearch,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),s("el-table",{staticStyle:{width:"100%","margin-bottom":"15px"},attrs:{data:e.showTable}},[s("el-table-column",{attrs:{prop:"label"}}),s("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"medium",type:"danger",icon:"el-icon-remove"},on:{click:function(s){return e.removeApprover(t.$index)}}},[e._v("Удалить")])]}}])})],1),s("div",{attrs:{align:"right"}},[e.showTable.length>0?s("el-button",{staticClass:"body-button",attrs:{icon:"el-icon-check",type:"info"},on:{click:e.sendToApprove}},[e._v(" Отправить на согласование ")]):e._e()],1)],1)])},K=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b",[s("label",[e._v("Добавление согласующих:")])])}],Q={name:"requestDetailBusinessApproveAdd",data:function(){return{approver:{},approverFromSearch:[],showTable:[],queryData:{approver:[],comment:""}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId}},methods:{addApprover(){this.queryData.approver.indexOf(this.approver)<0?(this.queryData.approver.push(this.approver),this.approverFromSearch.forEach(e=>{e.value===this.approver&&this.showTable.push({label:e.label})})):this.$store.commit("setMessage",{text:"Выбранный согласующий был добавлен ранее! ",type:"warning"}),this.approver="",this.approverFromSearch=[]},async searchApprover(e){let t="/api/vicarious/user/search",s=await this.$store.dispatch("query",{url:t,data:{q:e}});"success"==s.status&&(this.approverFromSearch=s.data)},removeApprover(e){this.showTable.splice(e,1),this.queryData.approver.splice(e,1)},async sendToApprove(){this.loading=!0;let e=new FormData;e.append("request_id",this.requestId),e.append("coordinator_id",this.queryData.approver),e.append("commment",this.queryData.comment),e.append("file[0]",this.$refs.upload.uploadFiles[0].raw);let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/coordination-add",data:e,type:"file"});"success"==t.status?(this.$store.commit("setMessage",{text:t.message,type:"success"}),this.$store.commit("setRequestState",{status:"pending_agree",value:"На согласовании"}),this.$refs.upload.clearFiles()):this.$store.commit("setMessage",{text:t.message,type:"error"}),this.loading=!1}}},X=Q,Z=Object(h["a"])(X,Y,K,!1,null,null,null),ee=Z.exports,te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.showTable}},[s("el-table-column",{attrs:{align:"left",prop:"label",label:"Согласующие заявку"}}),s("el-table-column",{attrs:{align:"left",prop:"solution",label:"Решение по заявке"}})],1),e.currentApproverId===e.user_id?s("div",{staticClass:"component-wrapper"},[s("label",[e._v("Комментарий")]),s("el-input",{class:e.errors.comment?"invalid":"",attrs:{type:"textarea",rows:"4"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),e.errors.comment?s("small",[e._v(e._s(e.errors.comment))]):e._e(),s("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"right"}},[s("el-button",{staticClass:"body-button",attrs:{icon:"el-icon-check",type:"success"},on:{click:function(t){return e.requestDecision(!0)}}},[e._v(" Утвердить ")]),s("el-button",{staticClass:"body-button",attrs:{icon:"el-icon-close",type:"danger"},on:{click:function(t){return e.requestDecision(!1)}}},[e._v(" Отклонить ")])],1)],1):e._e()],1)},se=[],ae={name:"requestDetailBusinessApprovePending",data(){return{currentApproverId:null,currentApproverKey:null,comment:"",showTable:[],errors:{comment:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId},user_id(){return this.$store.getters.userId}},methods:{async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/coordination-list",data:{request_id:this.requestId}});if("success"==e.status)if(e.data instanceof Array){let t=null,s=!0;e.data.forEach(e=>{1===e.solution&&(t="Согласовано"),0===e.solution&&(t="Отказ согласования",s=!1),null===e.solution&&(t="В очереди"),null===e.solution&&s&&(this.currentApproverId=e.value,this.currentApproverKey=e.key,t="На согласовании",s=!1),this.showTable.push({label:e.label,solution:t})})}else"agree"===e.request_status&&this.$store.commit("setRequestState",{status:e.request_status,value:"Согласована"}),"rejected"===e.request_status&&this.$store.commit("setRequestState",{status:e.request_status,value:"Заявка отклонена"});else this.$store.commit("setMessage",{text:e.message,type:"error"});this.loading=!1},async requestDecision(e){if(e||this.comment){this.loading=!0;let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/coordination-solution",data:{request_id:this.requestId,user_id:this.user_id,id:this.currentApproverKey,solution:e,reason:this.comment}});"success"==t.status?this.$store.commit("setMessage",{text:t.message,type:"success"}):this.$store.commit("setMessage",{text:t.message,type:"error"}),this.loading=!1,this.showTable=[],this.getData()}else this.errors.comment="Необходимо указать причину!"}},created(){this.getData()},watch:{comment:function(){this.errors.comment=null}}},re=ae,ie=(s("db79"),Object(h["a"])(re,te,se,!1,null,"1bcac3a0",null)),oe=ie.exports,ne={name:"requestDetailBusiness",components:{Add:ee,Pending:oe},emits:["toShowPage"],data(){return{storages:[],isApproving:!1,queryData:{id:"",storageId:"",storageName:""},errors:{storage:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId},requestStatus(){return this.$store.getters.requestState},isRoot(){return this.$store.getters.charters("root")},isResponsible(){return this.$store.getters.isResponsible},gen_document(){return this.$store.getters.genDocument},document_project(){return this.$store.getters.document_project},project_file(){return this.$store.getters.projectFile},signature(){return this.$store.getters.signature},documentId(){return this.$store.getters.documentId},documentName(){return this.$store.getters.documentName},documentStorage(){return this.$store.getters.documentStorage}},methods:{backToShow(){this.$emit("toShowPage")},async fileChange(e){this.loading=!0;let t=new FormData;t.append("document_id",this.documentId),t.append("name",this.$store.getters.documentName+"_"+(new Date).toLocaleDateString().split(".").join("_")),t.append("file[0]",this.$refs.uploadProject.uploadFiles[0].raw);let s=await this.$store.dispatch("query",{url:"/api/vicarious/request/upload-project",data:t,type:"file"});this.$refs.uploadProject.clearFiles(),"success"==s.status?(this.$store.commit("document_project",!0),this.$store.commit("projectFile",s.href.value),this.$store.commit("setMessage",{text:s.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:s.message,header:"Возникла проблема!",type:"error"}),this.loading=!1},goToDocument(){this.$store.commit("setPage","document"),this.$store.commit("setComponent","detail")},returnToWork(){this.$confirm(`Вы уверены, что хотите Вернуть заявку с ID - ${this.requestId} в работу ? Связанный с этой заявкой документ, при наличии, будет удален!`).then(async()=>{let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/update-status",data:{id:this.requestId,type:"performed"}});"success"===e.status?(this.$store.commit("setRequestState",{status:"performed",value:"Принята в работу"}),this.$store.commit("setGenDocument",0),this.queryData.storageId="",this.queryData.storageName="",this.$store.commit("setDocumentId",null),this.$store.commit("setDocumentName",null),this.$store.commit("document_project",null),this.$store.commit("projectFile",null),this.$store.commit("setDocumentStorage",null),this.$store.commit("setMessage",{text:e.msg,type:"success"})):this.$store.commit("setMessage",{text:"Возникла проблема!",type:"error"})}).catch(()=>{})},returnToCreated(){this.$confirm(`Вы уверены, что хотите Вернуть заявку с ID - ${this.requestId} в "Заявка создана" ? Связанный с этой заявкой документ, при наличии, будет удален!`).then(async()=>{let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/update-status",data:{id:this.requestId,type:"created"}});"success"===e.status?(this.$store.commit("setRequestState",{status:"created",value:"Заявка создана"}),this.$store.commit("setGenDocument",0),this.queryData.storageId="",this.queryData.storageName="",this.$store.commit("setDocumentId",null),this.$store.commit("setDocumentName",null),this.$store.commit("document_project",null),this.$store.commit("projectFile",null),this.$store.commit("setDocumentStorage",null),this.$store.commit("setMessage",{text:e.msg,type:"success"})):this.$store.commit("setMessage",{text:"Возникла проблема!",type:"error"})}).catch(()=>{})},async toSignature(){let e;this.loading=!0,e=this.signature?0:1;let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/signature",data:{id:this.requestId,signature:e}});"success"==t.status?(this.$store.commit("setSignature",e),this.$store.commit("setMessage",{text:"Успешно",header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:"Не успешно",header:"Возникла проблема!",type:"error"}),this.loading=!1},cancelApprove(){this.$confirm(`Вы уверены, что хотите прервать процесс согласования заявки с ID - ${this.requestId} ?`).then(async()=>{this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/coordination-stop",data:{id:this.requestId}});"success"==e.status?(this.$store.commit("setRequestState",{status:e.request_status,value:"Принята в работу"}),this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}).catch(()=>{})},async getDocument(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/gen-document",data:{id:this.requestId,name:!0}});if("success"===e.status){let t="Текущая заявка";if(e.name&&(t=e.name),this.$store.commit("setDocumentName",t.match(/.*\./i)[0].slice(0,-1)),e=await this.$store.dispatch("query",{url:"/api/vicarious/request/gen-document",data:{id:this.requestId},downloadRequest:!0}),200===e.status){let s=await e.blob(),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=t,a.click(),URL.revokeObjectURL(a.href),this.$store.commit("setGenDocument",1),e=await this.$store.dispatch("query",{url:"/api/vicarious/request/gen-document",data:{id:this.requestId,doc_id:!0}}),e.length>0?this.$store.commit("setDocumentId",e[0]):this.$store.commit("setDocumentId",null)}else this.$store.commit("setMessage",{text:e.message,type:"error"})}else this.$store.commit("setMessage",{text:e.message,type:"error"});this.loading=!1},async saveStorage(){if(""===this.queryData.storageId)return void(this.errors.storage="Необходимо выбрать место!");this.queryData.id=this.$store.getters.documentId;let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/set-storage",data:{id:this.queryData.id,storage:this.queryData.storageId}});"success"==e.status?(this.$store.commit("setDocumentStorage",this.queryData.storageId),this.storages.forEach(e=>{e.value!=this.queryData.storageId||(this.queryData.storageName=e.label)}),this.$store.commit("setMessage",{text:e.message,type:"success"})):this.$store.commit("setMessage",{text:e.message,type:"error"})},async completedRequest(){let e=this.$refs.uploadScan.uploadFiles[0].raw.type;if("application/pdf"==e||"image/jpeg"==e){this.loading=!0;let e=new FormData;e.append("id",this.requestId),e.append("name",this.$store.getters.documentName+"_"+(new Date).toLocaleDateString().split(".").join("_")),e.append("file[0]",this.$refs.uploadScan.uploadFiles[0].raw);let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/upload-scan",data:e,type:"file"});"success"==t.status?(this.$store.commit("setMessage",{text:t.message,type:"success"}),"completed"===t.request_status&&(this.$store.commit("setRequestState",{status:t.request_status,value:"Выполнена"}),this.$store.commit("setSignature",0))):this.$store.commit("setMessage",{text:t.message,type:"error"}),this.$refs.uploadScan.clearFiles(),this.loading=!1}else this.$store.commit("setMessage",{text:"Необходимо прикрепить файл в формате PDF или JPEG или JPG",header:"Не верный формат файла",type:"error"}),this.$refs.uploadScan.clearFiles()},async getData(){let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/list"});"success"==e.status&&(this.storages=e.data.map(e=>({value:e.id,label:e.name}))),this.queryData.storageId=this.documentStorage,this.storages.forEach(e=>{e.value!==this.documentStorage||(this.queryData.storageName=e.label)})}},created(){"pending_agree"===this.requestStatus.status?this.isApproving=!0:this.isApproving=!1,this.getData(),window.vicariousLoadFile=async function(e,t,s){try{let a=await this.$store.dispatch("query",{url:"/api/vicarious/request/load-file",downloadRequest:!0,data:{document_project_id:e,type:s}}),r=await a.blob(),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=t,o.click(),URL.revokeObjectURL(o.href)}catch(a){this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}return!1}.bind(this)},watch:{"requestStatus.status":function(){"pending_agree"===this.requestStatus.status?this.isApproving=!0:this.isApproving=!1,this.getData()},"queryData.storageId":function(){this.errors.storage=null}}},le=ne,ue=Object(h["a"])(le,B,J,!1,null,null,null),ce=ue.exports,de=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("h2",[e._v(" Заявка № "+e._s(e.requestId))]),s("h3",[e._v("Статус заявки - "+e._s(e.requestStatus.value)+" "+e._s(e.signature?", на подписании":""))]),s("hr"),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.showTable}},[s("el-table-column",{attrs:{align:"left",prop:"label",label:"Решение принял"}}),s("el-table-column",{attrs:{align:"left",prop:"solution",label:"Состояние"}}),s("el-table-column",{attrs:{align:"left",prop:"comment",label:"Комментарий"}}),s("el-table-column",{attrs:{align:"left",prop:"date",label:"Дата"}})],1),s("div",{staticClass:"body-button-container"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.backToShow}},[e._v(" Вернуться к информации о заявке ")])],1)],1)},he=[],me={name:"requestDetailComments",emits:["backToShow"],data(){return{showTable:[]}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId},requestStatus(){return this.$store.getters.requestState},signature(){return this.$store.getters.signature}},methods:{backToShow(){this.$emit("toShowPage")},async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/solution-list",data:{request_id:this.requestId}});if("success"==e.status){if(e.data instanceof Array){let t=null,s=!0;e.data.forEach(e=>{1===e.solution&&(t="Согласовано"),0===e.solution&&(t="Заявка отклонена",s=!1),null===e.solution&&(t="-"),null===e.solution&&s&&(t="На согласовании",s=!1),this.showTable.push({label:e.label,solution:t,comment:e.comment,date:e.date})}),e.data.length<=0&&this.showTable.push({label:"Процесс согласования не запускался",solution:"-",comment:"-",date:"-"})}}else this.$store.commit("setMessage",{text:e.message,type:"error"});this.loading=!1}},created(){this.getData()}},pe=me,ye=Object(h["a"])(pe,de,he,!1,null,null,null),ge=ye.exports,fe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("h2",[e._v(" Заявка № "+e._s(e.requestId))]),s("h3",[e._v("Статус заявки - "+e._s(e.requestStatus.value)+" "+e._s(e.signature?", на подписании":"")+" ")]),s("hr"),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.showTable}},[s("el-table-column",{attrs:{align:"left",prop:"date_update",label:"Дата изменения"}}),s("el-table-column",{attrs:{align:"left",prop:"who_change",label:"Исполнитель"}}),s("el-table-column",{attrs:{align:"left",prop:"modification",label:"Изменение"}}),s("el-table-column",{attrs:{align:"left",prop:"previous_value",label:"Предыдущее значение"}}),s("el-table-column",{attrs:{align:"left",prop:"new_value",label:"Новое значение"}})],1),s("div",{staticClass:"body-button-container"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.backToShow}},[e._v(" Вернуться к информации о заявке ")])],1)],1)},ve=[],be={name:"requestDetailHistory",emits:["backToShow"],data(){return{showTable:[],map:{function:"Функционал",company:"Организация",comment:"Комментарий",status:"Статус",document_type:"Тип документа",type:"Тип заявки",document_name:"Имя документа",document_start:"Дата начала действия документа",document_final:"Дата окончания действия документа","gen-document":"Создан документ","":"-"}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId},requestStatus(){return this.$store.getters.requestState},signature(){return this.$store.getters.signature}},methods:{backToShow(){this.$emit("toShowPage")},async getData(){this.loading=!0,this.$store.getters.queryType.forEach(e=>{this.map[e.value]=e.label}),this.$store.getters.queryTypeDocument.forEach(e=>{this.map[e.value]=e.label}),this.$store.getters.queryStatusDocument.forEach(e=>{this.map[e.value]=e.label}),this.$store.getters.statusList.forEach(e=>{this.map[e.value]=e.label}),this.showTable=[];let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/history",data:{id:this.requestId}});if("success"==e.status){if(e.data instanceof Array){let t={};e.data.forEach(e=>{t={date_update:e.date_update,modification:this.map[e.modification],who_change:e.who_change,new_value:this.map[e.new_value]?this.map[e.new_value]:e.new_value,previous_value:this.map[e.previous_value]?this.map[e.previous_value]:e.previous_value},this.showTable.push(t)})}}else this.$store.commit("setMessage",{text:e.message,type:"error"});this.loading=!1}},created(){this.getData()}},qe=be,_e=Object(h["a"])(qe,fe,ve,!1,null,null,null),we=_e.exports,De={name:"requestDetail",components:{Show:G,Business:ce,Comments:ge,History:we},data(){return{menu:{show:"Информация о заявке",business:"Действия с заявкой",comments:"История согласования",history:"История изменений"},page:"show"}},methods:{setActiveMenu(e){if(null==e)return!1;this.page=e.name}}},$e=De,xe=Object(h["a"])($e,T,j,!1,null,null,null),Se=xe.exports,Ce={name:"pageRequest",components:{Add:p,AddByExist:q,List:S,Edit:M,Detail:Se},computed:{component:function(){return this.$store.getters.component}}},ke=Ce,Ie=Object(h["a"])(ke,o,n,!1,null,null,null),Re=Ie.exports,Fe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s(e.component,{tag:"component"})],1)},Me=[],Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.gridReady?s("Grid",{directives:[{name:"event-bus",rawName:"v-event-bus:saveVisibleColumn",value:e.saveVisibleColumn,expression:"saveVisibleColumn",arg:"saveVisibleColumn"},{name:"event-bus",rawName:"v-event-bus:saveOrderColumn",value:e.saveOrderColumn,expression:"saveOrderColumn",arg:"saveOrderColumn"},{name:"event-bus",rawName:"v-event-bus:saveWidthColumn",value:e.saveWidthColumn,expression:"saveWidthColumn",arg:"saveWidthColumn"},{name:"event-bus",rawName:"v-event-bus:onSort",value:e.onSort,expression:"onSort",arg:"onSort"},{name:"event-bus",rawName:"v-event-bus:changeFilterProfile",value:e.changeFilterProfile,expression:"changeFilterProfile",arg:"changeFilterProfile"}],attrs:{name:"document"}}):e._e()],1)},je=[],Pe={name:"documentList",data:function(){return{grid:{filter:{data:{id:{show:!1,type:"number",name:"ID документа"},request_id:{show:!1,type:"number",name:"ID заявки"},usersIndividual:{type:"searchlist",name:"Доверенное лицо",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},usersEntity:{show:!1,type:"searchlist",name:"Доверенная организация",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/company/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},company_id:{type:"searchlist",name:"Организация",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/company/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},name:{type:"searchlist",name:"Номер документа",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/document-search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},document_type:{type:"list",name:"Тип доверенности",multiple:!0,option:this.$store.getters.queryTypeDocument},status:{type:"list",name:"Статус",multiple:!0,option:this.$store.getters.queryStatusDocument},created_at:{show:!1,type:"date",name:"Дата создания"},document_start:{show:!1,type:"date",name:"Дата начала действия документа"},document_final:{show:!1,type:"date",name:"Дата окончания действия документа"},functions:{show:!1,type:"searchlist",name:"Функционал документа",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/function/search",data:{q:e}});if("success"==t.status){let e=t.data.map(e=>({value:e.value,label:e.label}));return e}}.bind(this),focus:async function(){let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{sort:{name:"sort",order:"asc"}}});if("success"==e.status){let t=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value}));return t}}.bind(this)},storage_id:{type:"list",name:"Хранение оригинала",multiple:!0,show:!1,option:[]}},profiles:[],showProfiles:!0,filter:function(e){this.filterData=e,this.$store.commit("setPaginationPage",1),this.getData()}.bind(this),clear:function(){this.filterData={},this.getData()}.bind(this)},context:[{name:"Открыть документ",function:function(e){this.$store.commit("setDocumentId",e.id[0].value),this.$store.commit("setRequestId",e.request_id[0].value),this.$store.commit("setComponent","detail")}.bind(this)},{name:"Копировать данные в новую заявку",function:function(e){this.$store.commit("setDocumentId",e.id[0].value),this.$store.commit("setRequestId",e.request_id[0].value),this.$confirm(`Вы уверены, что хотите создать новую заявку на основе данных заявки с ID - ${this.requestId} ?`).then(()=>{this.$store.commit("setPage","request"),this.$store.commit("setComponent","addByExist")}).catch(()=>{})}.bind(this)}],pagination:{show:"full",page:1,defaultSize:10,sizes:[10,20,50],changeSize:function(e){this.$store.commit("setPaginationSize",e),this.$grid.commit("normalizePagination",{name:"document",data:{pagination:{defaultSize:e}}}),this.getData()}.bind(this),changePage:function(e){this.$store.commit("setPaginationPage",e),this.getData()}.bind(this)},header:{id:{name:"ID документа",width:150,contentSort:!0},name:{name:"Номер документа",width:200,contentSort:!0},request_id:{name:"ID заявки",width:150,contentSort:!0},users:{name:"Пользователи документа",width:300},company:{name:"Организация",width:200},document_type:{name:"Тип доверенности ",width:200,contentSort:!0},status:{name:"Статус",width:150,contentSort:!0},created_at:{name:"Дата создания",width:200,contentSort:!0},document_start:{name:"Начало действия документа",width:250,contentSort:!0},document_final:{name:"Окончание действия документа",width:300,contentSort:!0},file:{name:"Сканы документов",width:250},functions:{name:"Функционал документа",width:300},storage_id:{name:"Хранение оригинала",width:250,contentSort:!0}},elements:[],name:"document"},filterData:{},sort:{name:"id",order:"desc"},gridReady:!1}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},requestId(){return this.$store.getters.requestId}},methods:{async getData(){this.loading=!0,this.grid.filter.data.storage_id.option=[];let e=await this.$store.dispatch("normalizeFilterData",this.filterData),t=await this.$store.dispatch("query",{url:"/api/vicarious/storage/list"});"success"==t.status&&(this.grid.filter.data.storage_id.option=t.data.map(e=>({value:e.id,label:e.name})));let s={showAll:"",showDocument:"",user:[],company:[],department:[],department_child:[]};this.$store.getters.charters("showAll")?s.showAll="showAll":s.showAll="",this.$store.getters.charters("showDocument")?s.showDocument="showDocument":s.showDocument="";let a=this.$store.getters.individuals;a.forEach(e=>{e.name&&e.detail&&s[e.name].push(e.detail)}),t=await this.$store.dispatch("query",{url:"/api/vicarious/request/document-list",data:{count:this.$store.getters.paginationSize,page:this.$store.getters.paginationPage,filter:e,charters:s,sort:this.sort}}),"success"==t.status?(this.$grid.commit("normalizeElement",{name:this.grid.name,data:{elements:t.data}}),this.$grid.commit("normalizePagination",{name:this.grid.name,data:{pagination:{page:this.$store.getters.paginationPage,...t.pagination}}})):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},onSort(e){this.sort.name=e.key,this.sort.name===e.key?"asc"===this.sort.order?this.sort.order="desc":this.sort.order="asc":this.sort.order="desc",this.getData()},saveVisibleColumn(e){function t(e){this.grid.header[e.key].show=e.show,this.grid.header[e.key].child instanceof Array&&this.grid.header[e.key].child.forEach((s,a)=>{let r={key:this.grid.header[e.key].child[a],show:e.show};t.call(this,r)})}t.call(this,e),this.setHeaderParams()},saveWidthColumn(e){this.grid.header[e.key].width=e.width,this.setHeaderParams()},saveOrderColumn(e){e.data.forEach(e=>{let t=e.key,s=e.params.sort;this.grid.header[t].sort=s}),this.setHeaderParams()},async changeFilterProfile(e){this.loading=!0,"add"===e.action&&this.grid.filter.profiles.push({name:e.name,data:e.data}),"remove"===e.action&&this.grid.filter.profiles.splice(e.idx,1);let t=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:e.grid,params:JSON.stringify(this.grid.filter.profiles),type:"set"}});"success"==t.status?this.$store.commit("setMessage",{text:t.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},async setHeaderParams(){let e=Object.keys(this.grid.header),t=e.map(e=>{let t;return t=!("show"in this.grid.header[e])||this.grid.header[e].show,{key:e,width:this.grid.header[e].width,show:t,sort:this.grid.header[e].sort}}),s=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,params:JSON.stringify(t),type:"set"}});"success"==s.status?this.$store.commit("setMessage",{text:s.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})},async initGrid(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,type:"get"}});if("success"==e.status&&e.data.length>0){let t=JSON.parse(e.data[0]);t.forEach(e=>{e.key in this.grid.header&&(this.grid.header[e.key].show=e.show,this.grid.header[e.key].width=e.width,this.grid.header[e.key].sort=e.sort)})}if("success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),e=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:this.grid.name,type:"get"}}),"success"===e.status&&e.data.length>0){let t=JSON.parse(e.data);t.forEach(e=>{this.grid.filter.profiles.push(e)})}"success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.$grid.dispatch("createGrid",{name:this.grid.name,data:this.grid}),await this.getData(),this.gridReady=!0,this.loading=!1}},created:function(){window.vicariousLoadFile=async function(e,t,s){try{let a=await this.$store.dispatch("query",{url:"/api/vicarious/request/load-file",downloadRequest:!0,data:{scan_id:e,type:s}}),r=await a.blob(),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=t,o.click(),URL.revokeObjectURL(o.href)}catch(a){this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}return!1}.bind(this),this.initGrid()}},Oe=Pe,Ee=Object(h["a"])(Oe,Te,je,!1,null,null,null),Ne=Ee.exports,ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:18}},[s("h2",[e._v("Доверенность № "+e._s(e.documentName))]),s("h3",[e._v("Статус: "+e._s(e.map[e.documentStatus]))])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"component-wrapper"},[s("el-button",{attrs:{size:"medium",icon:"el-icon-document",type:"info"},on:{click:e.goToRequest}},[e._v(" Перейти к заявке № "+e._s(e.requestId)+" ")])],1)])],1),e.loading?e._e():s("Show",{model:{value:e.show,callback:function(t){e.show=t},expression:"show"}}),s("br"),!e.isManageRequest&&!e.isRoot||e.reject?e._e():s("div",{staticClass:"component-wrapper"},[e.isForSignature||e.isActive?s("div",{staticClass:"body-button-container"},[s("span",{staticClass:"body-button"},[s("label",[e._v("Хранение оригинала")]),s("el-select",{class:e.errors.storage?"invalid":"",attrs:{placeholder:"Хранение оригинала"},model:{value:e.queryData.storageId,callback:function(t){e.$set(e.queryData,"storageId",t)},expression:"queryData.storageId"}},e._l(e.storages,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-button",{attrs:{size:"medium",icon:"el-icon-check",type:"primary"},on:{click:e.saveStorage}})],1):e._e(),e.isActive&&e.isRoot?s("div",{staticClass:"body-button-container"},[s("span",{staticClass:"body-button"},[s("label",[e._v("Новый функционал для документа")]),s("el-select",{class:e.errors.functions?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-button",{attrs:{size:"medium",icon:"el-icon-check",type:"primary",disabled:!e.isActive},on:{click:e.saveFunction}})],1):e._e()]),s("br"),e.reject?s("div",[e.isActive?s("div",{staticClass:"body-button-container"},[s("span",{staticClass:"body-button"},[s("label",[e._v("Дата прекращения действия")]),s("el-date-picker",{class:e.errors.dateFinalNew?"invalid":"",staticStyle:{width:"30%"},attrs:{"picker-options":{firstDayOfWeek:1},type:"date",format:"dd.MM.yyyy","value-format":"dd.MM.yyyy",placeholder:"Прекращение действия документа"},model:{value:e.dateFinalNew,callback:function(t){e.dateFinalNew=t},expression:"dateFinalNew"}}),e.errors.dateFinalNew?s("small",[e._v(e._s(e.errors.dateFinalNew))]):e._e()],1)]):e._e(),s("br"),s("label",[e._v("Причина "+e._s(e.isForSignature?"аннулирования":"прекращения действия")+" документа")]),s("el-input",{class:e.errors.comment?"invalid":"",attrs:{type:"textarea",rows:"4"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),e.errors.comment?s("small",[e._v(e._s(e.errors.comment))]):e._e(),s("div",{staticClass:"body-button-container"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-back",type:"info"},on:{click:e.noCancelDocument}},[e._v(" Назад ")]),s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-check",type:"danger"},on:{click:e.confirmCancelDocument}},[e._v(" "+e._s(e.isForSignature?"Аннулировать":"Прекратить действие")+" ")])],1)],1):s("div",[s("div",{staticClass:"body-button-container"},[s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-plus",type:"info"},on:{click:e.addByExist}},[e._v(" Копировать данные в новую заявку ")]),(e.isManageRequest||e.isRoot)&&(e.isForSignature||e.isActive)?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-download",type:"info"},on:{click:e.getDocument}},[e._v(" Сформировать проект документа ")]):e._e(),e.isManageRequest&&e.documentStorage&&(e.isForSignature||e.isActive)||e.isRoot&&"cancel"!==e.documentStatus?s("el-upload",{ref:"upload",staticClass:"body-button",attrs:{action:"","auto-upload":!1,"on-change":e.upLoadScan,multiple:!1}},[s("el-button",{attrs:{icon:"el-icon-upload2",size:"medium",type:"info"}},[e._v(" Загрузить подписанный документ ")])],1):e._e(),(e.isManageRequest||e.isRoot)&&(e.isForSignature||e.isActive)?s("el-button",{staticClass:"body-button",attrs:{size:"medium",icon:"el-icon-close",type:"danger"},on:{click:e.cancelDocument}},[e._v(" "+e._s(e.isForSignature?"Аннулировать документ":"Прекратить действие")+" ")]):e._e()],1)])],1)},Le=[],Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"component-wrapper"},[s("el-table",{staticClass:"tableWithOutHeader",attrs:{data:e.value}},[s("el-table-column",{attrs:{prop:"label",width:"350"}}),s("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.value,(function(t){return s("p",{staticStyle:{margin:"0px"}},[s("span",{domProps:{innerHTML:e._s(t)}})])}))}}])})],1)],1)},Ue=[],We={name:"documentDetailShow",props:["value"]},Ve=We,He=Object(h["a"])(Ve,Ae,Ue,!1,null,null,null),Ge=He.exports,Be={name:"documentDetail",components:{Show:Ge},data(){return{documentStatus:"",show:[],functions:[],storages:[],map:{},reject:!1,dateFinal:"",dateFinalNew:"",comment:"",queryData:{functions:[],storageId:"",storageName:""},errors:{functions:null,comment:null,storage:null,dateFinalNew:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},documentId(){return this.$store.getters.documentId},documentName(){return this.$store.getters.documentName},requestId(){return this.$store.getters.requestId},isManageRequest(){return this.$store.getters.charters("manageRequest")},isRoot(){return this.$store.getters.charters("root")},documentStorage(){return this.$store.getters.documentStorage},isActive(){return"active"===this.documentStatus},isForSignature(){return"for_signature"===this.documentStatus}},methods:{goToRequest(){this.$store.commit("setPage","request"),this.$store.commit("setComponent","detail")},async saveFunction(){if(this.queryData.functions.length<=0)return void(this.errors.functions="Необходимо выбрать функционал!");let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/update-functions",data:{id:this.requestId,functions:this.queryData.functions}});"success"==e.status?(this.$store.commit("setMessage",{text:e.message,type:"success"}),this.queryData.functions=[],this.getData()):this.$store.commit("setMessage",{text:e.message,type:"error"})},async saveStorage(){if(""===this.queryData.storage)return void(this.errors.storage="Необходимо выбрать место!");let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/set-storage",data:{id:this.documentId,storage:this.queryData.storageId}});"success"==e.status?(this.$store.commit("setDocumentStorage",this.queryData.storageId),this.storages.forEach(e=>{e.value!==this.queryData.storageId||(this.queryData.storageName=e.label)}),this.$store.commit("setMessage",{text:e.message,type:"success"}),this.getData()):this.$store.commit("setMessage",{text:e.message,type:"error"})},addByExist(){this.$confirm(`Вы уверены, что хотите создать новую заявку на основе данных заявки с ID - ${this.requestId} ?`).then(()=>{this.$store.commit("setPage","request"),this.$store.commit("setComponent","addByExist")}).catch(()=>{})},async getDocument(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/gen-document",data:{id:this.requestId,name:!0}});if("success"===e.status){let t="Текущая заявка";if(e.name&&(t=e.name),e=await this.$store.dispatch("query",{url:"/api/vicarious/request/gen-document",data:{id:this.requestId},downloadRequest:!0}),200===e.status){let s=await e.blob(),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=t,a.click(),URL.revokeObjectURL(a.href)}else this.$store.commit("setMessage",{text:e.message,type:"error"})}else this.$store.commit("setMessage",{text:e.message,type:"error"});this.loading=!1},async upLoadScan(){let e=this.$refs.upload.uploadFiles[0].raw.type;if("application/pdf"==e||"image/jpeg"==e){this.loading=!0;let e=new FormData;e.append("id",this.requestId),e.append("name",this.$store.getters.documentName+"_"+(new Date).toLocaleDateString().split(".").join("_")),e.append("file[0]",this.$refs.upload.uploadFiles[0].raw);let t=await this.$store.dispatch("query",{url:"/api/vicarious/request/upload-scan",data:e,type:"file"});"success"==t.status?this.$store.commit("setMessage",{text:t.message,type:"success"}):this.$store.commit("setMessage",{text:t.message,type:"error"}),this.$refs.upload.clearFiles(),this.getData(),this.loading=!1}else this.$store.commit("setMessage",{text:"Необходимо прикрепить файл в формате PDF",header:"Не верный формат файла",type:"error"}),this.$refs.upload.clearFiles()},cancelDocument(){this.reject=!0,setTimeout(()=>{window.scrollTo(0,15e3)},0)},noCancelDocument(){this.comment="",this.reject=!1},confirmCancelDocument(){let e=new Date(this.dateFinalNew.split(".").reverse().join(".")).getTime()-new Date(this.dateFinal.split(".").reverse().join(".")).getTime();if(e>0)return void(this.errors.dateFinalNew="Выбранная дата не может превышать дату окончания действия документа. !");if(!this.dateFinalNew)return void(this.errors.dateFinalNew="Необходимо указать дату!");if(!this.comment)return void(this.errors.comment="Необходимо указать причину!");let t=null;this.isActive&&(t="terminated"),this.isForSignature&&(t="cancel"),this.$confirm(`Вы уверены, что хотите ${this.isForSignature?"анулировать документ":"прекратить действие документа"}  с ID - ${this.documentId} ?`).then(async()=>{this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/request/document-cancel",data:{id:this.documentId,request_id:this.requestId,reason:this.comment,status:t,date_cancel:this.dateFinalNew}});"success"==e.status?(this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}),await this.getData()):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема с аннулированием документа!",type:"error"}),this.comment="",this.reject=!1,this.loading=!1}).catch(()=>{})},async getData(){this.loading=!0,this.$store.getters.queryStatusDocument.forEach(e=>{this.map[e.value]=e.label});let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/list"});"success"==e.status&&(this.storages=e.data.map(e=>({value:e.id,label:e.name}))),e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}}),"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value}))),e=await this.$store.dispatch("query",{url:"/api/vicarious/request/get-edit",data:{id:this.requestId}});let t=[];if("success"==e.status?e.data.functions.forEach(e=>{this.functions.forEach(s=>{s.value===e&&t.push(s.label)})}):(this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),t.push("Проблема с получением данных")),e=await this.$store.dispatch("query",{url:"/api/vicarious/request/document-get",data:{id:this.documentId}}),"success"==e.status){this.dateFinal=e.data.document_final,this.queryData.storageId=e.data.storage_id,this.$store.commit("setDocumentStorage",this.queryData.storageId),this.storages.forEach(e=>{e.value!==this.queryData.storageId||(this.queryData.storageName=e.label)}),this.$store.commit("setDocumentName",e.data.name),this.documentStatus=e.data.status;let s="";s="cancel"===this.documentStatus||"terminated"===this.documentStatus?e.data.date_cancel+", "+e.data.who_cancel+",  причина - "+e.data.reason:"";let a=[];e.data.files.length>0?a=e.data.files.map(e=>e.value):a.push("Нет данных");let r=[],i="";if(i=e.data.receiver,"individual"===i){if(e.data.users.length>0)for(let t=0;t<e.data.users.length;t++)if(r.push(e.data.users[t].href+", "+e.data.users[t].department+", "+e.data.users[t].position),e.data.users[t].org instanceof Array)for(let s=0;s<e.data.users[t].org.length;s++)r.push("( "+e.data.users[t].org[s].name+", "+e.data.users[t].org[s].position+" )")}else e.data.users.length>0&&r.push(e.data.users[0].label);this.show=[{label:"Начало действия документа",value:[e.data.document_start]},{label:"Окончание действия документа",value:[e.data.document_final]},{label:"ID документа",value:[e.data.id]},{label:"ID заявки",value:[e.data.request_id]},{label:"Тип доверенности",value:[e.data.document_type]},{label:"Заказчик",value:e.data.creator.map(e=>e.value+", "+e.department+", "+e.position)},{label:"individual"===i?"Доверенное лицо":"Доверенная организация",value:r},{label:"Организация",value:[e.data.company]},{label:"Функционал",value:t},{label:"Хранение оригинала",value:[this.queryData.storageName]},{label:"Причина аннулирования / прекращения",value:[s]},{label:"Сканы документов",value:a}]}else this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"});setTimeout(()=>{window.scrollTo(0,15e3)},0),this.loading=!1}},created(){window.vicariousLoadFile=async function(e,t,s){try{let a=await this.$store.dispatch("query",{url:"/api/vicarious/request/load-file",downloadRequest:!0,data:{scan_id:e,type:s}}),r=await a.blob(),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=t,o.click(),URL.revokeObjectURL(o.href)}catch(a){this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}return!1}.bind(this),this.dateFinalNew=(new Date).toLocaleDateString(),this.getData()},watch:{"queryData.functions":function(){this.errors.functions=null},"queryData.storage":function(){this.errors.storage=null},comment:function(){this.errors.comment=null},dateFinalNew:function(){this.errors.dateFinalNew=null}}},Je=Be,Ye=Object(h["a"])(Je,ze,Le,!1,null,null,null),Ke=Ye.exports,Qe={name:"documentPage",components:{List:Ne,Detail:Ke},computed:{component:function(){return this.$store.getters.component}}},Xe=Qe,Ze=Object(h["a"])(Xe,Fe,Me,!1,null,null,null),et=Ze.exports,tt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s(e.component,{tag:"component"})],1)},st=[],at=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.gridReady?s("Grid",{directives:[{name:"event-bus",rawName:"v-event-bus:saveVisibleColumn",value:e.saveVisibleColumn,expression:"saveVisibleColumn",arg:"saveVisibleColumn"},{name:"event-bus",rawName:"v-event-bus:saveOrderColumn",value:e.saveOrderColumn,expression:"saveOrderColumn",arg:"saveOrderColumn"},{name:"event-bus",rawName:"v-event-bus:saveWidthColumn",value:e.saveWidthColumn,expression:"saveWidthColumn",arg:"saveWidthColumn"},{name:"event-bus",rawName:"v-event-bus:onSort",value:e.onSort,expression:"onSort",arg:"onSort"},{name:"event-bus",rawName:"v-event-bus:changeFilterProfile",value:e.changeFilterProfile,expression:"changeFilterProfile",arg:"changeFilterProfile"}],attrs:{name:"function"}}):e._e()],1)},rt=[],it={name:"functionList",data:function(){return{grid:{filter:{data:{id:{show:!1,type:"number",name:"ID"},name:{type:"searchlist",name:"Название",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{q:e}});if("success"==t.status){let e=t.data.map(e=>({value:e.id[0].value,label:e.name[0].value}));return e}}.bind(this)},function:{type:"list",name:"Тип функции",multiple:!0,option:this.$store.getters.function_type},active:{type:"list",name:"Активность",multiple:!1,option:[{value:[1],label:"Активна"},{value:[0],label:"Не активна"}]},created_at:{type:"date",name:"Дата создания"}},profiles:[],showProfiles:!0,filter:function(e){this.filterData=e,this.$store.commit("setPaginationPage",1),this.getData()}.bind(this),clear:function(){this.filterData={},this.getData()}.bind(this)},context:[{name:"Редактировать",function:function(e){this.$store.commit("setComponent","edit"),this.$store.commit("setComponentParams",e)}.bind(this)}],pagination:{show:"full",page:1,defaultSize:10,sizes:[10,20,50],changeSize:function(e){this.$store.commit("setPaginationSize",e),this.$grid.commit("normalizePagination",{name:"function",data:{pagination:{defaultSize:e}}}),this.getData()}.bind(this),changePage:function(e){this.$store.commit("setPaginationPage",e),this.getData()}.bind(this)},header:{id:{name:"ID",width:100,contentSort:!0},sort:{name:"Сортировка",width:100,contentSort:!0},name:{name:"Название",width:450,contentSort:!0},text:{name:"Текст в документе",width:600},function:{name:"Тип функции",width:250,contentSort:!0},active:{name:"Активность",width:200,contentSort:!0},created_at:{name:"Дата создания",width:300,contentSort:!0},note:{name:"Примечания",width:600}},elements:[],name:"function"},filterData:{},sort:{name:"id",order:"asc"},gridReady:!1}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0;let e=await this.$store.dispatch("normalizeFilterData",this.filterData),t=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{count:this.$store.getters.paginationSize,page:this.$store.getters.paginationPage,filter:e,sort:this.sort}});"success"==t.status?(this.$grid.commit("normalizeElement",{name:this.grid.name,data:{elements:t.data}}),this.$grid.commit("normalizePagination",{name:this.grid.name,data:{pagination:{page:this.$store.getters.paginationPage,...t.pagination}}})):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},onSort(e){this.sort.name=e.key,this.sort.name===e.key?"asc"===this.sort.order?this.sort.order="desc":this.sort.order="asc":this.sort.order="desc",this.getData()},saveVisibleColumn(e){this.grid.header[e.key].show=e.show,this.setHeaderParams()},saveWidthColumn(e){this.grid.header[e.key].width=e.width,this.setHeaderParams()},saveOrderColumn(e){e.data.forEach(e=>{let t=e.key,s=e.params.sort;this.grid.header[t].sort=s}),this.setHeaderParams()},async changeFilterProfile(e){this.loading=!0,"add"===e.action&&this.grid.filter.profiles.push({name:e.name,data:e.data}),"remove"===e.action&&this.grid.filter.profiles.splice(e.idx,1);let t=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:e.grid,params:JSON.stringify(this.grid.filter.profiles),type:"set"}});"success"==t.status?this.$store.commit("setMessage",{text:t.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},async setHeaderParams(){let e=Object.keys(this.grid.header),t=e.map(e=>{let t;return t=!("show"in this.grid.header[e])||this.grid.header[e].show,{key:e,width:this.grid.header[e].width,show:t,sort:this.grid.header[e].sort}}),s=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,params:JSON.stringify(t),type:"set"}});"success"==s.status?this.$store.commit("setMessage",{text:s.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})},async initGrid(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,type:"get"}});if("success"==e.status&&e.data.length>0){let t=JSON.parse(e.data[0]);t.forEach(e=>{e.key in this.grid.header&&(this.grid.header[e.key].show=e.show,this.grid.header[e.key].width=e.width,this.grid.header[e.key].sort=e.sort)})}if("success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),e=await this.$store.dispatch("query",{url:"/api/vicarious/filter-preset",data:{grid:this.grid.name,type:"get"}}),"success"===e.status&&e.data.length>0){let t=JSON.parse(e.data);t.forEach(e=>{this.grid.filter.profiles.push(e)})}"success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.$grid.dispatch("createGrid",{name:this.grid.name,data:this.grid}),await this.getData(),this.gridReady=!0,this.loading=!1}},created(){this.initGrid()}},ot=it,nt=Object(h["a"])(ot,at,rt,!1,null,null,null),lt=nt.exports,ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание новой функции")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Название")]),s("el-input",{class:e.errors.name?"invalid":"",attrs:{type:"text",placeholder:"Укажите название"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}}),e.errors.name?s("small",[e._v(e._s(e.errors.name))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип функционала")]),s("el-select",{class:e.errors.function?"invalid":"",attrs:{placeholder:"Тип функционала"},model:{value:e.formData.function,callback:function(t){e.$set(e.formData,"function",t)},expression:"formData.function"}},e._l(e.function_type,(function(e){return s("el-option",{key:e.key,attrs:{label:e.label,value:e.value}})})),1),e.errors.function?s("small",[e._v(e._s(e.errors.function))]):e._e()],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Текст в документе")]),s("el-input",{class:e.errors.text?"invalid":"",attrs:{type:"textarea",rows:"4",placeholder:"Укажите текст"},model:{value:e.formData.text,callback:function(t){e.$set(e.formData,"text",t)},expression:"formData.text"}}),e.errors.text?s("small",[e._v(e._s(e.errors.text))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Примечание")]),s("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"Укажите примечание"},model:{value:e.formData.note,callback:function(t){e.$set(e.formData,"note",t)},expression:"formData.note"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.setFormData}},[e._v("Добавить функцию")])],1)],1)],1)],1)},ct=[],dt={name:"functionAdd",data:function(){return{formData:{name:"",text:"",note:"",function:""},errors:{name:null,text:null,function:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},function_type(){return this.$store.getters.function_type}},methods:{isValid(e){for(let s in this.errors)this.errors[s]=null;let t=!0;return e.name||(t=!1,this.errors.name="Необходимо ввести название функционала!"),e.text||(t=!1,this.errors.text="Необходимо выбрать тип функционала!"),e.function||(t=!1,this.errors.function="Необходимо текс в документе!"),t},async setFormData(){if(this.isValid(this.formData)){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/add",data:this.formData});"success"==e.status?(this.formData={name:"",text:"",note:"",function:""},this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}}},watch:{"formData.name":function(){this.errors.name=null},"formData.function":function(){this.errors.function=null},"formData.text":function(){this.errors.text=null}}},ht=dt,mt=(s("c506"),Object(h["a"])(ht,ut,ct,!1,null,"d512c330",null)),pt=mt.exports,yt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Редактирование функции")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Название")]),s("el-input",{class:e.errors.name?"invalid":"",attrs:{type:"text"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}}),e.errors.name?s("small",[e._v(e._s(e.errors.name))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Тип функции")]),s("el-select",{attrs:{placeholder:"Тип функции"},model:{value:e.formData.function,callback:function(t){e.$set(e.formData,"function",t)},expression:"formData.function"}},e._l(e.function_type,(function(e){return s("el-option",{key:e.key,attrs:{label:e.label,value:e.value}})})),1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Позиция в сортировке")]),s("el-input",{attrs:{placeholder:"Введите число",type:"number",min:"1"},model:{value:e.formData.sort,callback:function(t){e.$set(e.formData,"sort",e._n(t))},expression:"formData.sort"}})],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Активность")]),s("el-checkbox-group",{attrs:{fill:"#909399","text-color":"white"},model:{value:e.formData.active,callback:function(t){e.$set(e.formData,"active",t)},expression:"formData.active"}},[s("el-checkbox-button",{attrs:{label:e.formData.active?"Вкл":"Откл"},model:{value:e.formData.active,callback:function(t){e.$set(e.formData,"active",t)},expression:"formData.active"}})],1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Текст в документе")]),s("el-input",{class:e.errors.text?"invalid":"",attrs:{type:"textarea",rows:"10"},model:{value:e.formData.text,callback:function(t){e.$set(e.formData,"text",t)},expression:"formData.text"}}),e.errors.text?s("small",[e._v(e._s(e.errors.text))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Примечание")]),s("el-input",{attrs:{type:"textarea",rows:"10"},model:{value:e.formData.note,callback:function(t){e.$set(e.formData,"note",t)},expression:"formData.note"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.setFormData}},[e._v("Сохранить функцию")])],1)],1)],1)],1)},gt=[],ft={name:"functionEdit",data:function(){return{formData:{name:"",text:"",note:"",function:"",active:!1,sort:""},errors:{name:null,text:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},function_type:function(){return this.$store.getters.function_type},id(){return this.$store.getters.componentParams.id[0].value}},methods:{isValid(e){for(let s in this.errors)this.errors[s]=null;let t=!0;return e.name||(t=!1,this.errors.name="Необходимо ввести название функционала!"),e.text||(t=!1,this.errors.text="Необходимо выбрать тип функционала!"),t},async setFormData(){if(this.isValid(this.formData)){this.loading=!0,this.formData.event="set";let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/edit",data:this.formData});"success"==e.status?this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}}},created:async function(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/edit",data:{id:this.id,event:"get"}});"success"==e.status?(this.formData.id=e.data.id,this.formData.name=e.data.name,this.formData.sort=e.data.sort,this.formData.text=e.data.text,this.formData.note=e.data.note,this.formData.function=e.data.function,this.formData.active=e.data.active):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1},watch:{"formData.name":function(){this.errors.name=null},"formData.text":function(){this.errors.text=null}}},vt=ft,bt=(s("58b0"),Object(h["a"])(vt,yt,gt,!1,null,"93a62786",null)),qt=bt.exports,_t={name:"functionPage",components:{List:lt,Add:pt,Edit:qt},computed:{component:function(){return this.$store.getters.component}}},wt=_t,Dt=Object(h["a"])(wt,tt,st,!1,null,null,null),$t=Dt.exports,xt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s(e.component,{tag:"component"})],1)},St=[],Ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.gridReady?s("Grid",{directives:[{name:"event-bus",rawName:"v-event-bus:saveVisibleColumn",value:e.saveVisibleColumn,expression:"saveVisibleColumn",arg:"saveVisibleColumn"},{name:"event-bus",rawName:"v-event-bus:saveOrderColumn",value:e.saveOrderColumn,expression:"saveOrderColumn",arg:"saveOrderColumn"},{name:"event-bus",rawName:"v-event-bus:saveWidthColumn",value:e.saveWidthColumn,expression:"saveWidthColumn",arg:"saveWidthColumn"},{name:"event-bus",rawName:"v-event-bus:onSort",value:e.onSort,expression:"onSort",arg:"onSort"}],attrs:{name:"users"}}):e._e()],1)},kt=[],It={name:"usersList",data:function(){return{grid:{filter:{data:{id:{show:!1,type:"number",name:"ID"},name:{type:"list",name:"Название",multiple:!0,option:[]},users:{type:"searchlist",name:"Пользователи",multiple:!0,query:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});if("success"==t.status)return t.data}.bind(this)},charter:{type:"list",name:"Права",multiple:!0,option:[]},created_at:{type:"date",name:"Дата создания"}},filter:function(e){this.filterData=e,this.getData()}.bind(this),clear:function(){this.filterData={},this.getData()}.bind(this)},context:[{name:"Редактировать",function:function(e){this.$store.commit("setComponent","connect"),this.$store.commit("setComponentParams",e)}.bind(this)},{name:"Удалить",function:function(e){this.$confirm(`Вы уверены, что хотите удалить группу - ${e.name[0].value} ?`).then(async()=>{this.deleteRole(e)}).catch(()=>{})}.bind(this)}],pagination:{show:"false"},header:{id:{name:"ID",width:100,contentSort:!0},name:{name:"Название",width:200,child:["users"]},users:{name:"Пользователи",width:300},charter:{name:"Права",width:300},note:{name:"Примечания",width:300},created_at:{name:"Дата создания",width:300,contentSort:!0}},elements:[],name:"users"},filterData:{},sort:{name:"id",order:"asc"},gridReady:!1}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0,this.grid.filter.data.name.option=[],this.grid.filter.data.charter.option=[];let e=await this.$store.dispatch("normalizeFilterData",this.filterData),t=await this.$store.dispatch("query",{url:"/api/vicarious/charter/list"});"success"==t.status&&(this.grid.filter.data.charter.option=t.data.map(e=>({value:e.id[0].value,label:e.name[0].value})));let s=await this.$store.dispatch("query",{url:"/api/vicarious/role/list",data:{filter:e,sort:this.sort}});if("success"==s.status){if(this.grid.filter.data.name.option=s.data.map(e=>({value:e.name[0].value,label:e.name[0].value})),this.$grid.commit("normalizeElement",{name:"users",data:{elements:s.data}}),0==Object.keys(e).length&&0==s.data.length){let t=[{name:"superUser",note:"Полный доступ"},{name:"requestResponsible",note:"Ответственные за заявки"},{name:"functionManager",note:"Управление функциями"},{name:"rejectRemover",note:"Удаление отклоненных заявок"},{name:"showDocument",note:"Просмотр всех документов"}];for(let e=0;e<t.length;e++)await this.$store.dispatch("query",{url:"/api/vicarious/role/add",data:t[e]});s=await this.$store.dispatch("query",{url:"/api/vicarious/role/list",data:{filter:e}}),this.$grid.commit("normalizeElement",{name:this.grid.name,data:{elements:s.data}})}}else this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"});this.loading=!1},async deleteRole(e){let t=["superUser","requestResponsible","functionManager","rejectRemover","showDocument"],s=e.name[0].value;if(t.indexOf(s)>=0)return void this.$store.commit("setMessage",{text:`Группу - ${s} удалять запрещено!`,type:"error"});this.loading=!0;let a=await this.$store.dispatch("query",{url:"/api/vicarious/role/delete",data:{role_id:e.id[0].value}});"success"==a.status?(this.getData(),this.$store.commit("setMessage",{text:a.message,type:"success"})):this.$store.commit("setMessage",{text:a.message,type:"error"}),this.loading=!1},onSort(e){this.sort.name=e.key,this.sort.name===e.key?"asc"===this.sort.order?this.sort.order="desc":this.sort.order="asc":this.sort.order="desc",this.getData()},saveVisibleColumn(e){this.grid.header[e.key].show=e.show,this.setHeaderParams()},saveWidthColumn(e){this.grid.header[e.key].width=e.width,this.setHeaderParams()},saveOrderColumn(e){e.data.forEach(e=>{let t=e.key,s=e.params.sort;this.grid.header[t].sort=s}),this.setHeaderParams()},async setHeaderParams(){let e=Object.keys(this.grid.header),t=e.map(e=>{let t;return t=!("show"in this.grid.header[e])||this.grid.header[e].show,{key:e,width:this.grid.header[e].width,show:t,sort:this.grid.header[e].sort}}),s=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,params:JSON.stringify(t),type:"set"}});"success"==s.status?this.$store.commit("setMessage",{text:s.message,type:"success"}):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})},async initGrid(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/setting",data:{grid:this.grid.name,type:"get"}});if("success"==e.status&&e.data.length>0){let t=JSON.parse(e.data[0]);t.forEach(e=>{e.key in this.grid.header&&(this.grid.header[e.key].show=e.show,this.grid.header[e.key].width=e.width,this.grid.header[e.key].sort=e.sort)})}"success"!==e.status&&this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.$grid.dispatch("createGrid",{name:this.grid.name,data:this.grid}),await this.getData(),this.gridReady=!0,this.loading=!1}},created(){this.initGrid()}},Rt=It,Ft=Object(h["a"])(Rt,Ct,kt,!1,null,null,null),Mt=Ft.exports,Tt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание новой группы пользователей")]),s("el-row",{staticClass:"mb15",attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Название")]),s("el-input",{class:e.errors.name?"invalid":"",attrs:{type:"text",placeholder:"Укажите название"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}}),e.errors.name?s("small",[e._v(e._s(e.errors.name))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Примечание")]),s("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"Укажите примечание"},model:{value:e.formData.note,callback:function(t){e.$set(e.formData,"note",t)},expression:"formData.note"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.setFormData}},[e._v("Добавить роль")])],1)],1)],1)],1)},jt=[],Pt={name:"usersAdd",data:function(){return{formData:{name:"",note:""},errors:{name:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{isValid(e){for(let s in this.errors)this.errors[s]=null;let t=!0;return e.name||(t=!1,this.errors.name="Необходимо ввести название роли!"),t},async setFormData(){if(this.isValid(this.formData)){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/role/add",data:this.formData});"success"==e.status?(this.formData={name:"",note:""},this.$store.commit("setMessage",{text:e.message,type:"success"})):this.$store.commit("setMessage",{text:e.message,type:"error"}),this.loading=!1}}},watch:{"formData.name":function(){this.errors.name=null}}},Ot=Pt,Et=(s("4627"),Object(h["a"])(Ot,Tt,jt,!1,null,"e098ae20",null)),Nt=Et.exports,zt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper",scopedSlots:e._u([{key:"header",fn:function(){return[s("div",{staticClass:"card-header"},[s("h3",[e._v("Редактирование группы пользователей - "+e._s(e.$store.getters.componentParams.name[0].value))])])]},proxy:!0}])},[s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Пользователь")]),s("el-select",{class:e.errors.user?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите ФИО","remote-method":e.searchUser,loading:e.loading},model:{value:e.connect.user,callback:function(t){e.$set(e.connect,"user",t)},expression:"connect.user"}},e._l(e.users,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.user?s("small",[e._v(e._s(e.errors.user))]):e._e()],1),s("el-col",{attrs:{span:4}},[s("label",[s("br")]),s("el-button",{staticClass:"fluid-button",attrs:{size:"small",icon:"el-icon-circle-plus",type:"info"},on:{click:e.addNewUser}},[e._v("Добавить")])],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:12}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.show.user}},[s("el-table-column",{attrs:{prop:"text",label:"Пользователи группы - "+e.$store.getters.componentParams.name[0].value}}),s("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-remove"},on:{click:function(s){return e.removeUser(t.$index)}}},[e._v("Удалить")])]}}])})],1)],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Привелегия")]),s("el-select",{class:e.errors.charter?"invalid":"",attrs:{placeholder:"Привелегии"},model:{value:e.connect.charter,callback:function(t){e.$set(e.connect,"charter",t)},expression:"connect.charter"}},e._l(e.charters,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.charter?s("small",[e._v(e._s(e.errors.charter))]):e._e()],1),s("el-col",{attrs:{span:4}},[s("label",[s("br")]),s("el-button",{staticClass:"fluid-button",attrs:{size:"small",icon:"el-icon-circle-plus",type:"info"},on:{click:e.addNewCharter}},[e._v("Добавить")])],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:12}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.show.charter}},[s("el-table-column",{attrs:{prop:"label",label:"Привелегии у группы - "+e.$store.getters.componentParams.name[0].value}}),s("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-remove"},on:{click:function(s){return e.removeCharter(t.$index)}}},[e._v("Удалить")])]}}])})],1)],1)],1)],1)],1)},Lt=[],At={name:"usersConnect",data:function(){return{formData:{charter:[],user:[]},connect:{charter:"",user:""},show:{user:[],charter:[]},users:[],charters:[],errors:{user:null,charter:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},role_id(){return this.$store.getters.componentParams.id[0].value}},methods:{getSyncData:async function(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/role/get-connect",data:{role_id:this.role_id}});"success"==e.status&&(this.show.user=e.data.user,this.show.charter=e.data.charter);let t=await this.$store.dispatch("query",{url:"/api/vicarious/charter/list",data:{}});"success"==t.status&&(this.charters=[],t.data.forEach(e=>{this.charters.push({value:e.id[0].value,label:e.label[0].value})})),this.loading=!1},addNewUser(){this.connect.user?this.setSyncUser():this.errors.user="Необходимо выбрать пользователя!"},setSyncUser:async function(){this.loading=!0,this.show.user.forEach(e=>{this.formData.user.push(e.value)}),""!==this.connect.user&&this.formData.user.push(this.connect.user);let e=await this.$store.dispatch("query",{url:"/api/vicarious/role/set-connect",data:{role_id:this.role_id,users:this.formData.user,type:"user"}});"success"==e.status?(this.formData={charter:[],user:[]},this.connect={charter:"",user:""},await this.getSyncData(),this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1},removeUser:function(e){this.$confirm(`Вы уверены, что хотите удалить пользователя - ${this.show.user[e].text} ?`).then(()=>{this.show.user.splice(e,1),this.setSyncUser()}).catch(()=>{})},addNewCharter(){this.connect.charter?this.setSyncCharter():this.errors.charter="Необходимо выбрать привелегию!"},async setSyncCharter(){this.loading=!0,this.show.charter.forEach(e=>{this.formData.charter.push(e.value)}),""!==this.connect.charter&&this.formData.charter.push(this.connect.charter);let e=await this.$store.dispatch("query",{url:"/api/vicarious/role/set-connect",data:{role_id:this.$store.getters.componentParams.id[0].value,charters:this.formData.charter,type:"charter"}});"success"==e.status?(this.formData={charter:[],user:[]},this.connect={charter:"",user:""},await this.getSyncData(),this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1},removeCharter:function(e){this.$confirm(`Вы уверены, что хотите удалить привелегию - ${this.show.charter[e].text}?`).then(()=>{this.show.charter.splice(e,1),this.setSyncCharter()}).catch(()=>{})},searchUser:async function(e){let t=await this.$store.dispatch("query",{url:"/api/vicarious/user/search",data:{q:e}});"success"==t.status&&(this.users=t.data)}},watch:{"connect.user":function(){this.errors.user=null},"connect.charter":function(){this.errors.charter=null}},async created(){await this.getSyncData()}},Ut=At,Wt=(s("c467"),Object(h["a"])(Ut,zt,Lt,!1,null,"29877766",null)),Vt=Wt.exports,Ht={name:"usersPage",components:{List:Mt,Add:Nt,Connect:Vt},computed:{component:function(){return this.$store.getters.component}}},Gt=Ht,Bt=Object(h["a"])(Gt,xt,St,!1,null,null,null),Jt=Bt.exports,Yt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s(e.component,{tag:"component"})],1)},Kt=[],Qt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание привелегии")]),s("el-row",{staticClass:"mb15",attrs:{gutter:8}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Выбрать тип привелегии")]),s("el-select",{attrs:{placeholder:"Выбрать тип привелегии"},model:{value:e.typeSelected,callback:function(t){e.typeSelected=t},expression:"typeSelected"}},e._l(e.type,(function(e,t){return s("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),"custom"===e.typeSelected?s("el-col",{attrs:{span:8}},[s("label",[e._v("Название")]),s("el-input",{ref:"custom_search",class:e.errors.charterToSent?"invalid":"",attrs:{type:"text",placeholder:"Укажите название"},on:{input:function(t){return e.clearSelectSearch("custom_search",e.custom,e.custom)}},model:{value:e.custom,callback:function(t){e.custom=t},expression:"custom"}}),e.errors.charterToSent?s("small",[e._v(e._s(e.errors.charterToSent))]):e._e()],1):e._e(),"user"===e.typeSelected?s("el-col",{attrs:{span:8}},[s("label",[e._v("Доверенное лицо")]),s("el-select",{ref:"user_search",class:e.errors.charterToSent?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите ФИО","remote-method":e.searchUser,loading:e.loading},on:{change:function(t){return e.clearSelectSearch("user_search",e.userSelected,e.users)}},model:{value:e.userSelected,callback:function(t){e.userSelected=t},expression:"userSelected"}},e._l(e.users,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.charterToSent?s("small",[e._v(e._s(e.errors.charterToSent))]):e._e()],1):e._e(),"company"===e.typeSelected?s("el-col",{attrs:{span:8}},[s("label",[e._v("Доверенная организация")]),s("el-select",{ref:"company_search",class:e.errors.charterToSent?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите организацию","remote-method":e.searchCompany,loading:e.loading},on:{change:function(t){return e.clearSelectSearch("company_search",e.companySelected,e.company)}},model:{value:e.companySelected,callback:function(t){e.companySelected=t},expression:"companySelected"}},e._l(e.company,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.charterToSent?s("small",[e._v(e._s(e.errors.charterToSent))]):e._e()],1):e._e(),"department"===e.typeSelected||"department_child"===e.typeSelected?s("el-col",{attrs:{span:8}},[s("label",[e._v("Департамент")]),s("el-select",{ref:"department_search",class:e.errors.charterToSent?"invalid":"",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"Укажите департамент или отдел","remote-method":e.searchDepartment,loading:e.loading},on:{change:function(t){return e.clearSelectSearch("department_search",e.departmentSelected,e.department)}},model:{value:e.departmentSelected,callback:function(t){e.departmentSelected=t},expression:"departmentSelected"}},e._l(e.department,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.errors.charterToSent?s("small",[e._v(e._s(e.errors.charterToSent))]):e._e()],1):e._e()],1),s("el-row",{staticClass:"mb15",attrs:{gutter:16}},[s("el-col",{attrs:{span:16}},[s("label",[e._v("Примечание")]),s("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"Укажите примечание"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.setFormData}},[e._v("Добавить привелегию")])],1)],1)],1)],1)},Xt=[],Zt={name:"accessAdd",data:function(){return{type:[{value:"user",label:"Доверенное лицо"},{value:"company",label:"Организация"},{value:"department",label:"Департамент, без иерархиии дочерних подразделений"},{value:"department_child",label:"Департамент, с иерархией дочерних подразделений"},{value:"custom",label:"Общее"}],label:"",typeSelected:"user",custom:"",users:[],userSelected:"",company:[],companySelected:"",department:[],departmentSelected:"",charterToSent:"",note:"",errors:{charterToSent:null}}},computed:{loading:{get(){return this.$store.getters.loading},set(e){this.$store.commit("setLoading",e)}}},methods:{clearSelectSearch:function(e,t,s){this.$refs[e].query="";let a="";this.charterToSent=t,s instanceof Array?(s.forEach(e=>{if(e.value===t)return a=e.label}),this.label="Документы -"+a):this.label=s},searchUser:function(e){""!==e&&this.search(e,"user")},searchCompany:function(e){""!==e&&this.search(e,"company")},searchDepartment:function(e){""!==e&&this.search(e,"department")},search:async function(e,t){let s,a;"user"==t&&(a="users",s="/api/vicarious/user/search"),"company"==t&&(a="company",s="/api/vicarious/company/search"),"department"==t&&(a="department",s="/api/vicarious/user/dep-search");let r=await this.$store.dispatch("query",{url:s,data:{q:e}});"success"==r.status&&(this[a]=r.data)},async setFormData(){if(!this.charterToSent)return void(this.errors.charterToSent="Необходимо ввести название привелегии!");let e=this.typeSelected,t=this.label;"custom"===this.charterToSent&&(e=this.custom,t=this.custom),this.loading=!0;let s=await this.$store.dispatch("query",{url:"/api/vicarious/charter/add",data:{name:e,label:t,individuals:this.charterToSent,note:this.note}});"success"==s.status?(this.charterToSent="",this.label="",this.custom="",this.usersSelected="",this.companySelected="",this.departmentSelected="",this.$store.commit("setMessage",{text:s.message,type:"success"})):this.$store.commit("setMessage",{text:s.message,type:"error"}),this.loading=!1}},watch:{typeSelected:function(){this.custom="",this.usersSelected="",this.companySelected="",this.departmentSelected="",this.errors.charterToSent=null},charterToSent:function(){this.errors.charterToSent=null}}},es=Zt,ts=(s("ca0d"),Object(h["a"])(es,Qt,Xt,!1,null,"bb0e2238",null)),ss=ts.exports,as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[s("Grid",{attrs:{name:"access"}})],1)},rs=[],is={name:"accessList",data:function(){return{grid:{filter:{data:{id:{show:!1,type:"number",name:"ID"},name:{type:"list",name:"Название",multiple:!0,option:[]},created_at:{type:"date",name:"Дата создания"}},filter:function(e){this.filterData=e,this.getData()}.bind(this),clear:function(){this.filterData={},this.getData()}.bind(this)},context:[{name:"Удалить",function:function(e){this.$confirm(`Вы уверены, что хотите удалить привелегию - ${e.label[0].value} ?`).then(async()=>{this.deleteCharter(e)}).catch(()=>{})}.bind(this)}],pagination:{show:"none"},header:{id:{name:"ID"},name:{name:"Название",width:200},label:{name:"Дополнение",width:200},note:{name:"Примечания",width:400},created_at:{name:"Дата создания",width:150}},elements:[]},filterData:{}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0,this.grid.filter.data.name.option=[];let e=await this.$store.dispatch("normalizeFilterData",this.filterData),t=await this.$store.dispatch("query",{url:"/api/vicarious/charter/list"});"success"==t.status&&(this.grid.filter.data.name.option=t.data.map(e=>({value:e.name[0].value,label:e.label[0].value})));let s=await this.$store.dispatch("query",{url:"/api/vicarious/charter/list",data:{filter:e}});if("success"==s.status){if(this.$grid.commit("normalizeElement",{name:"access",data:{elements:s.data}}),0==Object.keys(e).length&&0==s.data.length){let t=[{name:"showAll",note:"Просмотр всех заявок и документов",label:"showAll"},{name:"showDocument",note:"Просмотр всех документов",label:"showDocument"},{name:"manageRequest",note:"Администрирование заявок",label:"manageRequest"},{name:"manageFunction",note:"Администрирование функций",label:"manageFunction"},{name:"deleteRejected",note:"Удаление отклоненных заявок",label:"deleteRejected"},{name:"root",note:"Администрирование групп пользователей и прав доступа",label:"root"}];for(let e=0;e<t.length;e++)await this.$store.dispatch("query",{url:"/api/vicarious/charter/add",data:t[e]});s=await this.$store.dispatch("query",{url:"/api/vicarious/charter/list",data:{filter:e}}),this.$grid.commit("normalizeElement",{name:"access",data:{elements:s.data}})}}else this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"});this.loading=!1},async deleteCharter(e){let t=["showAll","showDocument","manageRequest","manageFunction","deleteRejected","root"],s=e.name[0].value;if(t.indexOf(s)>=0)return void this.$store.commit("setMessage",{text:`Привелегию - ${s} удалять запрещено!`,type:"error"});this.loading=!0;let a=await this.$store.dispatch("query",{url:"/api/vicarious/charter/delete",data:{charter_id:e.id[0].value}});"success"==a.status?(this.getData(),this.$store.commit("setMessage",{text:a.message,type:"success"})):this.$store.commit("setMessage",{text:a.message,type:"error"}),this.loading=!1}},created:function(){this.$grid.dispatch("createGrid",{name:"access",data:this.grid}),this.getData()}},os=is,ns=Object(h["a"])(os,as,rs,!1,null,null,null),ls=ns.exports,us={name:"accessPage",components:{List:ls,Add:ss},computed:{component:function(){return this.$store.getters.component}}},cs=us,ds=Object(h["a"])(cs,Yt,Kt,!1,null,null,null),hs=ds.exports,ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-card",{staticClass:"component-wrapper",scopedSlots:e._u([{key:"header",fn:function(){return[s("div",{staticClass:"card-header"},[s("h3",[e._v("Администрирование вариантов хранения оригиналов документа")])])]},proxy:!0}])},[s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Место хранения")]),s("el-input",{class:e.errors.storage?"invalid":"",attrs:{type:"text",placeholder:"Укажите место"},model:{value:e.storage,callback:function(t){e.storage=t},expression:"storage"}}),e.errors.storage?s("small",[e._v(e._s(e.errors.storage))]):e._e()],1),s("el-col",{attrs:{span:4}},[s("label",[s("br")]),s("el-button",{staticClass:"fluid-button",attrs:{size:"small",icon:"el-icon-circle-plus",type:"info"},on:{click:e.addNewStorage}},[e._v("Добавить")])],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:12}},[s("el-col",{attrs:{span:12}},[s("el-table",{attrs:{data:e.show}},[s("el-table-column",{attrs:{prop:"id",label:"ID"}}),s("el-table-column",{attrs:{prop:"name",label:"Название"}}),s("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-remove"},on:{click:function(s){return e.removeStorage(t.$index)}}},[e._v("Удалить")])]}}])})],1)],1)],1)],1)],1)},ps=[],ys={name:"storageList",data(){return{storage:"",show:[],errors:{storage:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/list"});if("success"==e.status){if(0===e.data.length){let t=[{name:"Выдано на руки"},{name:"ДПУ"},{name:"ДФИиУ"},{name:"ОП МСК"},{name:"ОП НСК"},{name:"ОП ЕКТ"},{name:"ОП СМР"}];for(let e=0;e<t.length;e++)await this.$store.dispatch("query",{url:"/api/vicarious/storage/add",data:t[e]});e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/list"})}this.show=e.data.map(e=>({id:e.id,name:e.name}))}else this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"});this.loading=!1},async addNewStorage(){if(""===this.storage)return void(this.errors.storage="Необходимо выбрать место!");this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/storage/add",data:{name:this.storage}});"success"==e.status?(this.storage="",this.$store.commit("setMessage",{text:e.message,type:"success"}),this.getData()):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},removeStorage(e){this.$confirm(`Вы уверены, что хотите удалить  - ${this.show[e].name} ?`).then(async()=>{this.loading=!0;let t=await this.$store.dispatch("query",{url:"/api/vicarious/storage/delete",data:{id:this.show[e].id}});"success"==t.status?(this.$store.commit("setMessage",{text:t.message,type:"success"}),this.show.splice(e,1),this.getData(),this.loading=!1):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}).catch(()=>{})}},created(){this.getData()},watch:{storage(){this.errors.storage=null}}},gs=ys,fs=Object(h["a"])(gs,ms,ps,!1,null,null,null),vs=fs.exports,bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(e.component,{tag:"component"})},qs=[],_s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Создание новой выгрузки")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Название выгрузки")]),s("el-input",{class:e.errors.name?"invalid":"",attrs:{placeholder:"Название выгрузки"},model:{value:e.queryData.name,callback:function(t){e.$set(e.queryData,"name",t)},expression:"queryData.name"}}),e.errors.name?s("small",[e._v(e._s(e.errors.name))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Описание выгрузки")]),s("el-input",{attrs:{type:"textarea",rows:"1",placeholder:"Описание выгрузки"},model:{value:e.queryData.description,callback:function(t){e.$set(e.queryData,"description",t)},expression:"queryData.description"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Функционал")]),s("el-select",{ref:"selectFunction",class:e.errors.function?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(t){return s("el-option",{key:t.value,style:{width:e.$refs.selectFunction.$el.offsetWidth+30+"px",whiteSpace:"normal",height:"auto"},attrs:{label:t.label,value:t.value}},[s("div",{on:{mouseover:function(s){return e.mouseOnFunctionOptions(s,!0,t)},mouseout:function(t){return e.mouseOnFunctionOptions(t,!1,"")}}},[e._v(" "+e._s(t.label)+" ")])])})),1),e.errors.function?s("small",[e._v(e._s(e.errors.function))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.saveForm}},[e._v(" Сохранить выгрузку ")])],1)],1)],1),e.functionsDetail.show?s("div",{staticClass:"context-menu-wrapper"},[e.functionsDetail.note?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Примечание")]),e._v(" "+e._s(e.functionsDetail.note))]):e._e(),e.functionsDetail.text?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Описание ")]),e._v(" "+e._s(e.functionsDetail.text))]):e._e()]):e._e()],1)},ws=[],Ds={name:"exchangeAdd",data(){return{queryData:{name:"",description:"",functions:[]},functionsDetail:{show:!1,text:"",note:""},functions:[],errors:{name:null,function:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{mouseOnFunctionOptions(e,t,s){t?(this.functionsDetail.show=!0,this.functionsDetail.text=s.text,this.functionsDetail.note=s.note,this.$nextTick(()=>{let t=document.querySelector(".context-menu-wrapper"),s={y:e.clientY};t.style.maxWidth="45%",t.style.position="relative",t.style.left=this.$refs.selectFunction.$el.offsetWidth+62+"px",s.y<this.$refs.selectFunction.$el.getBoundingClientRect().y?t.style.top="-190px":t.style.top="-22px"})):(this.functionsDetail.show=!1,this.functionsDetail.text="",this.functionsDetail.note="")},async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value,text:e.text[0].value,note:e.note[0].value}))),this.loading=!1},isValid(e){for(let s in this.errors)this.errors[s]=null;let t=!0;return e.name||(t=!1,this.errors.name="Необходимо ввести название выгрузки"),0===e.functions.length&&(t=!1,this.errors.function="Необходимо выбрать функцию"),t},async saveForm(){if(this.isValid(this.queryData)){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/exchange/add",data:this.queryData});"success"==e.status?(this.queryData={name:"",description:"",functions:""},this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"})):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}}},created(){this.getData()},watch:{"queryData.name":function(){this.errors.name=null},"queryData.functions":function(){this.errors.function=null}}},$s=Ds,xs=Object(h["a"])($s,_s,ws,!1,null,"535ea667",null),Ss=xs.exports,Cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-card",{staticClass:"component-wrapper",scopedSlots:e._u([{key:"header",fn:function(){return[s("div",{staticClass:"card-header"},[s("h3",[e._v("Варианты выгрузки данных")])])]},proxy:!0}])},[s("el-table",{attrs:{data:e.show}},[s("el-table-column",{attrs:{prop:"id",label:"ID",width:"100"}}),s("el-table-column",{attrs:{prop:"name",label:"Название",width:"250"}}),s("el-table-column",{attrs:{prop:"description",label:"Описание",width:"350"}}),s("el-table-column",{attrs:{label:"Функционал"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.functions,(function(t){return s("p",[e._v(" "+e._s(t.name)+" ")])}))}}])}),s("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-edit"},on:{click:function(s){return e.editExchange(t.row.id)}}}),s("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(s){return e.removeExchange(t.$index)}}})]}}])})],1)],1)],1)},ks=[],Is={name:"exchangeList",data(){return{show:[],functions:[]}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}}},methods:{async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/exchange/list",data:{}});"success"==e.status?this.show=e.data:this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},removeExchange(e){this.$confirm(`Вы уверены, что хотите удалить  - ${this.show[e].name} ?`).then(async()=>{this.loading=!0;let t=await this.$store.dispatch("query",{url:"/api/vicarious/exchange/delete",data:{id:this.show[e].id}});"success"==t.status?(this.$store.commit("setMessage",{text:t.message,type:"success"}),this.show.splice(e,1),this.getData(),this.loading=!1):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"})}).catch(()=>{})},editExchange(e){this.$confirm(`Вы уверены, что хотите редактировать выгрузку с ID ${e}?`).then(async()=>{this.$store.commit("setExchangeId",e),this.$store.commit("setComponent","edit")}).catch(()=>{})}},created(){this.getData()}},Rs=Is,Fs=Object(h["a"])(Rs,Cs,ks,!1,null,"4f8e3a24",null),Ms=Fs.exports,Ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"body-wrapper"},[s("el-button",{staticClass:"body-button body-button-color",attrs:{size:"medium",type:"info",icon:"el-icon-back"},on:{click:function(t){return t.preventDefault(),e.$store.commit("setComponent","list")}}},[e._v(" Вернуться к списку ")]),s("el-card",{staticClass:"component-wrapper"},[s("h3",[e._v("Редактирование выгрузки")]),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Название выгрузки")]),s("el-input",{class:e.errors.name?"invalid":"",attrs:{placeholder:"Название выгрузки"},model:{value:e.queryData.name,callback:function(t){e.$set(e.queryData,"name",t)},expression:"queryData.name"}}),e.errors.name?s("small",[e._v(e._s(e.errors.name))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("label",[e._v("Описание выгрузки")]),s("el-input",{attrs:{type:"textarea",rows:"1",placeholder:"Описание выгрузки"},model:{value:e.queryData.description,callback:function(t){e.$set(e.queryData,"description",t)},expression:"queryData.description"}})],1)],1),s("el-row",{staticClass:"mb15",attrs:{gutter:24}},[s("el-col",{attrs:{span:8}},[s("label",[e._v("Функционал")]),s("el-select",{ref:"selectFunction",class:e.errors.function?"invalid":"",attrs:{placeholder:"Функционал",multiple:""},model:{value:e.queryData.functions,callback:function(t){e.$set(e.queryData,"functions",t)},expression:"queryData.functions"}},e._l(e.functions,(function(t){return s("el-option",{key:t.value,style:{width:e.$refs.selectFunction.$el.offsetWidth+30+"px",whiteSpace:"normal",height:"auto"},attrs:{label:t.label,value:t.value}},[s("div",{on:{mouseover:function(s){return e.mouseOnFunctionOptions(s,!0,t)},mouseout:function(t){return e.mouseOnFunctionOptions(t,!1,"")}}},[e._v(" "+e._s(t.label)+" ")])])})),1),e.errors.function?s("small",[e._v(e._s(e.errors.function))]):e._e()],1),s("el-col",{attrs:{span:8}},[s("br")]),s("el-col",{attrs:{span:8}},[s("label",[s("br")]),s("el-button",{class:"fluid-button",attrs:{size:"medium",icon:"el-icon-upload",type:"primary"},on:{click:e.saveForm}},[e._v(" Сохранить выгрузку ")])],1)],1)],1),e.functionsDetail.show?s("div",{staticClass:"context-menu-wrapper"},[e.functionsDetail.note?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Примечание")]),e._v(" "+e._s(e.functionsDetail.note))]):e._e(),e.functionsDetail.text?s("div",{staticClass:"context-menu-element"},[s("h4",[e._v("Описание ")]),e._v(" "+e._s(e.functionsDetail.text))]):e._e()]):e._e()],1)},js=[],Ps={name:"exchangeEdit",data(){return{queryData:{name:"",description:"",functions:[]},functionsDetail:{show:!1,text:"",note:""},functions:[],errors:{name:null,function:null}}},computed:{loading:{get:function(){return this.$store.getters.loading},set:function(e){this.$store.commit("setLoading",e)}},exchangeId(){return this.$store.getters.exchangeId}},methods:{mouseOnFunctionOptions(e,t,s){t?(this.functionsDetail.show=!0,this.functionsDetail.text=s.text,this.functionsDetail.note=s.note,this.$nextTick(()=>{let t=document.querySelector(".context-menu-wrapper"),s={y:e.clientY};t.style.maxWidth="45%",t.style.position="relative",t.style.left=this.$refs.selectFunction.$el.offsetWidth+62+"px",s.y<this.$refs.selectFunction.$el.getBoundingClientRect().y?t.style.top="-190px":t.style.top="-22px"})):(this.functionsDetail.show=!1,this.functionsDetail.text="",this.functionsDetail.note="")},async getData(){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/function/list",data:{}});"success"==e.status&&(this.functions=e.data.map(e=>({value:e.id[0].value,label:e.name[0].value,text:e.text[0].value,note:e.note[0].value})));let t=await this.$store.dispatch("query",{url:"/api/vicarious/exchange/edit",data:{id:this.exchangeId,edit:"get"}});"success"==t.status?(this.queryData.id=t.data.id,this.queryData.name=t.data.name,this.queryData.description=t.data.description,this.queryData.functions=t.data.functions.map(e=>e.id)):this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема!",type:"error"}),this.loading=!1},isValid(e){for(let s in this.errors)this.errors[s]=null;let t=!0;return e.name||(t=!1,this.errors.name="Необходимо ввести название выгрузки"),0===e.functions.length&&(t=!1,this.errors.function="Необходимо выбрать функцию"),t},async saveForm(){if(this.isValid(this.queryData)){this.loading=!0;let e=await this.$store.dispatch("query",{url:"/api/vicarious/exchange/edit",data:{edit:"set",...this.queryData}});"success"==e.status?(this.$store.commit("setMessage",{text:e.message,header:"Успешно!",type:"success"}),this.$store.commit("setComponent","list")):this.$store.commit("setMessage",{text:e.message,header:"Возникла проблема!",type:"error"}),this.loading=!1}}},created(){this.getData()},watch:{"queryData.name":function(){this.errors.name=null},"queryData.functions":function(){this.errors.function=null}}},Os=Ps,Es=Object(h["a"])(Os,Ts,js,!1,null,"0fcf7058",null),Ns=Es.exports,zs={name:"pageExchange",components:{Add:Ss,List:Ms,Edit:Ns},computed:{component:function(){return this.$store.getters.component}}},Ls=zs,As=Object(h["a"])(Ls,bs,qs,!1,null,null,null),Us=As.exports,Ws={components:{documentPage:et,requestPage:Re,functionPage:$t,usersPage:Jt,accessPage:hs,storagePage:vs,exchangePage:Us},computed:{page:function(){return this.$store.getters.page},component:function(){return this.$store.getters.component},user_id(){return this.$store.getters.userId}},data:function(){return{isToken:!1,menu:{request:"Заявки",document:"Документы",users:"Группы пользователей",access:"Права доступа"},addLang:{request:"заявку",function:"функцию",users:"группу",access:"привелегию",exchange:"выгрузку"},error:""}},methods:{setActiveMenu(e){if(null==e)return!1;e!==this.$store.getters.page&&(this.$store.commit("setPage",e),this.$store.commit("setPaginationPage",1),this.$store.commit("setPaginationSize",10)),"list"!==this.component&&this.$store.commit("setComponent","list")},async initData(){window._userId?this.$store.commit("setUserId",window._userId):this.$store.commit("setUserId",null),window._token?window.token=window._token:window.token="";let e=await this.$store.dispatch("query",{url:"/api/vicarious/home",data:{id:this.user_id}});window.token?(this.isToken=!0,this.error="",e.charters?(this.$store.commit("setCharters",e.charters),this.manageMenu()):this.$store.commit("setCharters",[]),e.individuals?(this.$store.commit("setIndividuals",e.individuals),this.manageMenu()):this.$store.commit("setIndividuals",[])):(this.$store.commit("setMessage",{text:"Некорректный ответ сервера",header:"Возникла проблема c токеном!",type:"error"}),this.isToken=!1,this.error="Возникла проблема с получением токена при авторизации на сервере!",this.$store.commit("setCharters",[]))},manageMenu(){this.$store.getters.charters("root")?this.menu={request:"Заявки",document:"Документы",function:"Функционал",users:"Группы пользователей",access:"Права доступа",storage:"Варианты хранения оригинала",exchange:"Выгрузка"}:this.$store.getters.charters("manageRequest")?this.menu={request:"Заявки",document:"Документы",storage:"Варианты хранения оригинала"}:this.$store.getters.charters("manageFunction")&&(this.menu={request:"Заявки",document:"Документы",function:"Функционал"})}},created(){this.initData()}},Vs=Ws,Hs=(s("034f"),Object(h["a"])(Vs,r,i,!1,null,null,null)),Gs=Hs.exports,Bs=s("2f62");a["default"].use(Bs["a"]);var Js=new Bs["a"].Store({actions:{async query(e,t){"type"in t||(t.type="json");let s,a={};"json"==t.type?(s={token:window.token,...t.data},a["Content-Type"]="application/json;charset=utf-8"):(s=t.data,s.append("token",window.token));try{let r=t.url,i=await fetch(e.getters.domain+r,{method:"post",headers:a,body:"json"==t.type?JSON.stringify(s):s}),o=null;return o=t.downloadRequest?i:await i.json(),o}catch(r){return{status:"error",message:"Некорректный ответ сервера"}}},normalizeFilterData(e,t){let s={};for(let a in t)"number"!==t[a].type&&"date"!==t[a].type||!t[a].min||(s[a]=t[a]),("list"===t[a].type||"searchlist"===t[a].type)&&t[a].value.length>0&&(s[a]=t[a]);return s},formIsValid(e,t){let s={};return t.queryData.documentType||(s.documentType="Необходимо выбрать тип доверенности!"),t.queryData.company||(s.company="Необходимо выбрать организацию!"),t.queryData.users instanceof Array&&t.queryData.users.length<=0?s.users="Необходимо выбрать получателя!":t.queryData.users||(s.users="Необходимо выбрать получателя!"),t.queryData.functions.length<=0&&!t.queryData.comment&&!t.queryData.isFile&&(s.functions="Необходимо выбрать функционал или указать комментарий или прикрепить файл!"),t.queryData.dateStart||(s.dateStart="Необходимо указать начало действия документа!"),t.queryData.dateFinal||(s.dateFinal="Необходимо указать окончание действия документа!"),t.queryData.dateStart&&t.queryData.dateFinal&&Number(t.queryData.dateFinal.split(".").reverse().join(""))-Number(t.queryData.dateStart.split(".").reverse().join(""))<0&&(s.date="Дата начала действия документа не может быть позже даты окончания действия документа!"),s}},mutations:{setLoading(e,t){e.loading=t},setPage(e,t){e.previousPage=e.page,e.page=t,e.component=""},setComponent(e,t){e.component=t},setComponentParams(e,t){e.componentParams=t},setMessage(e,t){e.message=t,setTimeout(()=>{e.message={}},7e3)},setPaginationPage(e,t){e.paginationPage=t},setPaginationSize(e,t){e.paginationSize=t},setUserId(e,t){e.userId=t},setCreatorId(e,t){e.creatorId=t},setResponsibleId(e,t){e.responsibleId=t},setCharters(e,t){e.charters=t},setIndividuals(e,t){e.individuals=t},setDocumentId(e,t){e.documentId=t},setDocumentName(e,t){e.documentName=t},setGenDocument(e,t){e.genDocument=1===t},document_project(e,t){e.document_project=t},projectFile(e,t){e.projectFile=t},setSignature(e,t){e.signature=1===t},setDocumentStorage(e,t){e.documentStorage=t},setRequestId(e,t){e.requestId=t},setExchangeId(e,t){e.exchangeId=t},setRequestState(e,t){e.requestState=t}},state:{userId:null,creatorId:null,responsibleId:null,componentParams:{},documentId:null,genDocument:!1,document_project:!1,projectFile:"",signature:!1,documentName:null,documentStorage:null,requestId:null,requestState:{},exchangeId:{},loading:!1,charters:[],individuals:[],domain:window.location.origin,page:"request",previousPage:"",component:"list",message:{},paginationPage:1,paginationSize:10,function_type:[{key:"in",value:"in",label:"Входящая"},{key:"out",value:"out",label:"Исходящая"},{key:"int",value:"int",label:"Внутренняя"}],queryType:[{value:"personal",label:"Персональная"},{value:"complex",label:"По требованию"}],queryTypeDocument:[{value:"special",label:"Специальная"},{value:"notarial",label:"Нотариальная"}],queryStatusDocument:[{value:"for_signature",label:"Подготовка, на подписании"},{value:"active",label:"Действующий"},{value:"cancel",label:"Аннулирован"},{value:"terminated",label:"Действие прекращено досрочно"},{value:"expiration_date",label:"Действие прекращено по сроку"}],statusList:[{value:"created",label:"Заявка создана"},{value:"performed",label:"Принята в работу"},{value:"rejected",label:"Заявка отклонена"},{value:"pending_agree",label:"На согласовании"},{value:"agree",label:"Согласовна"},{value:"completed",label:"Выполнена"},{value:"deleted",label:"Удалена"}]},getters:{loading:e=>e.loading,domain:e=>e.domain,page:e=>e.page,previousPage:e=>e.previousPage,component:e=>e.component,message:e=>e.message,function_type:e=>e.function_type,queryType:e=>e.queryType,queryTypeDocument:e=>e.queryTypeDocument,queryStatusDocument:e=>e.queryStatusDocument,statusList:e=>e.statusList,paginationPage:e=>e.paginationPage,paginationSize:e=>e.paginationSize,componentParams:e=>e.componentParams,documentId:e=>e.documentId,documentStorage:e=>e.documentStorage,documentName:e=>e.documentName,document_project:e=>e.document_project,projectFile:e=>e.projectFile,genDocument:e=>e.genDocument,signature:e=>e.signature,requestId:e=>e.requestId,requestState:e=>e.requestState,exchangeId:e=>e.exchangeId,userId:e=>e.userId,charters:e=>t=>e.charters.indexOf(t)>=0,individuals:e=>e.individuals,isCreator:e=>e.userId===e.creatorId,isResponsible:e=>e.userId===e.responsibleId}}),Ys=s("e926");a["default"].use(Ys["a"]),a["default"].config.productionTip=!0,a["default"].prototype.$eventBus=new a["default"],a["default"].directive("eventBus",{bind(e,t){a["default"].prototype.$eventBus.$on(t.arg,t.value)},unbind(){a["default"].prototype.$eventBus.$off()}}),new a["default"]({store:Js,render(e){return e(Gs)}}).$mount("#app")},"58b0":function(e,t,s){"use strict";s("6b0c")},"6b0c":function(e,t,s){},"7bc5":function(e,t,s){},"85ec":function(e,t,s){},c467:function(e,t,s){"use strict";s("0698")},c506:function(e,t,s){"use strict";s("21bb")},ca0d:function(e,t,s){"use strict";s("7bc5")},cb85:function(e,t,s){},db79:function(e,t,s){"use strict";s("4cd8")}});
//# sourceMappingURL=app.697d2cc5.js.map